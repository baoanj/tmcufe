webpackJsonp([1],{"+jUS":function(t,e){},"0tlg":function(t,e){},"34yC":function(t,e){},"4UnJ":function(t,e){},"4yFy":function(t,e){},"5gYu":function(t,e){},"7jdX":function(t,e){},"8+uP":function(t,e){},"8eQQ":function(t,e){},"9BxH":function(t,e){},Br6R:function(t,e){},CQKV:function(t,e){},FAo6:function(t,e){},Hut3:function(t,e){},Jcsu:function(t,e){},N7mK:function(t,e){},NHnr:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("/5sW"),i=a("zL8q"),r=a.n(i),n=(a("tvR6"),a("OS1Z")),o=a.n(n),l=a("DAYN"),c=a.n(l),u=a("Bb5x"),d=(a("pw1w"),a("WiKS")),m=a.n(d),f=a("//Fk"),h=a.n(f),p=a("/ocq"),v={name:"PageLoading",props:{loading:{type:Boolean,default:!0},error:{type:Boolean,default:!1}}},g={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{directives:[{name:"loading",rawName:"v-loading",value:this.loading,expression:"loading"}],staticClass:"page-loading"},[this.error?e("div",{staticClass:"app-logo"}):this._e()])},staticRenderFns:[]};var b=a("VU/8")(v,g,!1,function(t){a("pu2X")},"data-v-2444f706",null).exports,w=a("mtWM"),_=a.n(w);function D(t){if(!t.response)return"未知错误";switch(t.response.status){case 400:return"无效请求";case 500:return"服务器错误";case 504:return"网络错误";default:return"未知错误"}}var F={get:function(t,e,a){return new h.a(function(s,i){_.a.get(t,{params:e,responseType:a}).then(function(t){s(t.data)}).catch(function(t){i(D(t))})})},post:function(t,e){return new h.a(function(a,s){_.a.post(t,e).then(function(t){a(t.data)}).catch(function(t){s(D(t))})})},put:function(t,e){return new h.a(function(a,s){_.a.put(t,e).then(function(t){a(t.data)}).catch(function(t){s(D(t))})})}};function k(t){return new h.a(function(e,a){F.post("/api/teacher/checkClassIdUnique",{classId:t}).then(function(t){0===t.stats?a(t.data.error):e()}).catch(function(){e()})})}var $={name:"ClassCard",props:{classs:{type:Object,default:function(){return{}}},move:{type:Boolean,default:!1}},computed:{isTA:function(){for(var t=this.$store.state.user.email,e=0;e<this.classs.tas.length;e+=1)if(this.classs.tas[e].email===t)return!0;return!1}}},C={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{class:{"box-card-1":!0,"box-card-2":!0,"box-card-move":t.move}},[a("el-card",[a("div",{staticClass:"clearfix text-line",attrs:{slot:"header"},slot:"header"},[a("router-link",{staticClass:"card-text-btn",attrs:{title:t.classs.name,to:{name:"ClassPage",params:{classId:t.classs.classId}}}},[t._v(t._s(t.classs.name))]),t._v(" "),t.isTA?a("el-tooltip",{attrs:{effect:"light",content:"你是这个班级的助教",placement:"right"}},[a("span",{staticClass:"ta-tag"},[t._v("TA")])]):t._e()],1),t._v(" "),a("div",[a("el-form",{attrs:{"label-width":"80px",size:"small"}},[a("el-form-item",{attrs:{label:"班级Id:"}},[t._v("\n          "+t._s(t.classs.classId)+"\n        ")]),t._v(" "),a("el-form-item",{attrs:{label:"密码:"}},[t._v("\n          "+t._s(t.classs.password)+"\n        ")]),t._v(" "),a("el-form-item",{attrs:{label:"任课老师:"}},[t._v("\n          "+t._s(t.classs.teacherName||"--")+"\n        ")]),t._v(" "),a("el-form-item",{attrs:{label:"作业数量:"}},[t._v("\n          "+t._s(t.classs.anountOfHws)+"\n        ")]),t._v(" "),a("el-form-item",{attrs:{label:"学生数量:"}},[t._v("\n          "+t._s(t.classs.amountOfStus)+"\n        ")])],1)],1)])],1)},staticRenderFns:[]};var x=a("VU/8")($,C,!1,function(t){a("FAo6")},"data-v-cb787312",null).exports,y={formateDate:function(t){var e=new Date(t);return e.getFullYear()+"-"+this.zeroFill(e.getMonth()+1)+"-"+this.zeroFill(e.getDate())+" "+this.zeroFill(e.getHours())+":"+this.zeroFill(e.getMinutes())+":"+this.zeroFill(e.getSeconds())},zeroFill:function(t){return("0"+t).slice(-2)},isString:function(t){return"string"==typeof t},isArray:function(t){return"[object Array]"==={}.toString.apply(t)},isPureObject:function(t){return"[object Object]"==={}.toString.apply(t)},isFile:function(t){return"[object File]"==={}.toString.apply(t)},isInteger:function(t){return"number"==typeof t&&t%1==0},isPositiveInteger:function(t){return"number"==typeof t&&t%1==0&&t>0},isNaturalNumber:function(t){return"number"==typeof t&&t%1==0&&t>=0},isIntegerStr:function(t){return"string"==typeof t&&/^-?\d+$/.test(t)},isNaturalNumberStr:function(t){return"string"==typeof t&&/^\d+$/.test(t)},isPositiveIntegerStr:function(t){return"string"==typeof t&&/^[0-9]*[1-9][0-9]*$/.test(t)},isFloatStr:function(t){return"string"==typeof t&&/^(-?\d+)(\.\d+)?$/.test(t)},validEmail:function(t){return/^[a-zA-Z0-9.+_-]+@([a-zA-Z0-9_-]+\.)+[a-zA-Z]{2,4}$/.test(t)},validCaptcha:function(t){return/^[a-zA-Z0-9]{4}$/.test(t)},validPhone:function(t){return/^1[3|4|5|7|8][0-9]\d{8}$/.test(t)},validPassword:function(t){return/^(?=.*[A-Z])(?=.*[a-z])(?=.*[0-9])[a-zA-Z0-9^\S]{6,32}$/.test(t)},validPassword2:function(t){return/^\S{6,20}$/.test(t)},validClassId:function(t){return/^.{6,20}$/.test(t)},validClassPass:function(t){return/^.{6,20}$/.test(t)},validClassName:function(t){return/^.{1,30}$/.test(t)},validHwTitle:function(t){return/^.{1,50}$/.test(t)}},S={bold:!0,italic:!0,header:!0,underline:!0,strikethrough:!0,mark:!0,superscript:!0,subscript:!0,quote:!0,ol:!0,ul:!0,link:!0,imagelink:!1,code:!0,table:!0,fullscreen:!0,readmodel:!0,htmlcode:!1,help:!0,undo:!0,redo:!0,trash:!0,save:!1,navigation:!0,alignleft:!0,aligncenter:!0,alignright:!0,subfield:!0,preview:!0},I={name:"MarkdownEditor",props:{edit:{type:Boolean,default:!0},value:{type:String,default:""}},data:function(){return{toolbars:S}}},T={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[t.edit?a("div",{staticClass:"edit"},[a("mavon-editor",{attrs:{toolbars:t.toolbars,value:t.value},on:{change:function(e){return t.$emit("change",e)}}})],1):a("div",{staticClass:"not-edit"},[a("mavon-editor",{attrs:{toolbarsFlag:!1,subfield:!1,defaultOpen:"preview",value:t.value}})],1)])},staticRenderFns:[]};var E=a("VU/8")(I,T,!1,function(t){a("Vm1m")},"data-v-f2a53e86",null).exports,L={name:"FullscreenDialog",props:{visible:{type:Boolean,default:!1},title:{type:String,default:""}}},A={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{title:t.title,fullscreen:!0,center:!0,visible:t.visible,"show-close":!1}},[t._t("default"),t._v(" "),a("el-button",{staticClass:"close",attrs:{type:"primary",icon:"el-icon-close",circle:""},on:{click:function(e){t.$emit("close")}}})],2)},staticRenderFns:[]};var V=a("VU/8")(L,A,!1,function(t){a("+jUS")},"data-v-bf15b6ea",null).exports,P={name:"AddClassDialog",props:{dialogVisible:{type:Boolean,default:!1}},components:{MarkdownEditor:E,FullscreenDialog:V},data:function(){return{ruleForm:{classId:"",name:"",teacherName:"",password:"",message:""},rules:{classId:[{required:!0,validator:function(t,e,a){e?y.validClassId(e)?k(e).then(function(){a()},function(t){a(new Error(t))}):a(new Error("6-20个字符")):a(new Error("必填"))},trigger:"blur"}],name:[{required:!0,validator:function(t,e,a){""===e?a(new Error("必填")):a()},trigger:"blur"}],password:[{required:!0,validator:function(t,e,a){""===e?a(new Error("必填")):y.validClassPass(e)?a():a(new Error("6-20个字符"))},trigger:"blur"}]},loading:!1}},methods:{submitForm:function(t){var e=this;this.$refs[t].validate(function(t){var a;t&&(e.loading=!0,(a={classId:e.ruleForm.classId,name:e.ruleForm.name,teacherName:e.ruleForm.teacherName,password:e.ruleForm.password,message:e.ruleForm.message},new h.a(function(t,e){F.post("/api/teacher/addClass",a).then(function(a){0===a.stats?e(a.data.error):t()}).catch(function(t){e(t)})})).then(function(){e.loading=!1,e.$emit("hideDialog"),e.$emit("fetchData")}).catch(function(t){e.loading=!1,e.$message.error(t)}))})},closeDialog:function(){this.resetForm("ruleForm"),this.$emit("hideDialog")},resetForm:function(t){this.$refs[t].resetFields()}}},H={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("fullscreen-dialog",{attrs:{title:"新建班级",visible:t.dialogVisible},on:{close:t.closeDialog}},[a("el-form",{ref:"ruleForm",attrs:{model:t.ruleForm,"status-icon":"",rules:t.rules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"班级Id",prop:"classId"}},[a("el-input",{attrs:{maxlength:20,placeholder:"唯一，6-20个字符"},model:{value:t.ruleForm.classId,callback:function(e){t.$set(t.ruleForm,"classId",e)},expression:"ruleForm.classId"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"密码",prop:"password"}},[a("el-input",{attrs:{maxlength:20,placeholder:"公开给班里学生，6-20个字符"},model:{value:t.ruleForm.password,callback:function(e){t.$set(t.ruleForm,"password",e)},expression:"ruleForm.password"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"班级名称",prop:"name"}},[a("el-row",[a("el-col",{attrs:{span:20}},[a("el-input",{attrs:{placeholder:"30字以内",clearable:!0,maxlength:30},model:{value:t.ruleForm.name,callback:function(e){t.$set(t.ruleForm,"name",e)},expression:"ruleForm.name"}})],1),t._v(" "),a("el-col",{attrs:{span:4}},[a("span",{staticStyle:{"padding-left":"5px"}},[t._v(t._s(t.ruleForm.name.length)+"/30")])])],1)],1),t._v(" "),a("el-form-item",{attrs:{label:"其他信息",prop:"message"}},[a("markdown-editor",{attrs:{value:t.ruleForm.message},on:{change:function(e){return t.ruleForm.message=e}}})],1),t._v(" "),a("el-form-item",{attrs:{label:"任课教师",prop:"teacherName"}},[a("el-input",{attrs:{"auto-complete":"on"},model:{value:t.ruleForm.teacherName,callback:function(e){t.$set(t.ruleForm,"teacherName",e)},expression:"ruleForm.teacherName"}})],1),t._v(" "),a("el-form-item",[a("el-button",{on:{click:t.closeDialog}},[t._v("取消")]),t._v(" "),a("el-button",{staticClass:"submit-btn",attrs:{type:"primary",loading:t.loading},on:{click:function(e){t.submitForm("ruleForm")}}},[t._v("提交")])],1)],1)],1)},staticRenderFns:[]};var R=a("VU/8")(P,H,!1,function(t){a("9BxH")},"data-v-12c63898",null).exports,N={name:"EnterClassDialog",props:{dialogVisible:{type:Boolean,default:!1}},data:function(){return{ruleForm:{classId:"",password:""},rules:{classId:[{required:!0,validator:function(t,e,a){e?k(e).then(function(){a(new Error("班级Id不存在"))},function(){a()}):a(new Error("必填"))},trigger:"blur"}],password:[{required:!0,validator:function(t,e,a){""===e?a(new Error("请输入密码")):a()},trigger:"blur"}]},loading:!1}},methods:{submitForm:function(t){var e=this;this.$refs[t].validate(function(t){var a;t&&(e.loading=!0,(a={classId:e.ruleForm.classId,password:e.ruleForm.password},new h.a(function(t,e){F.post("/api/student/enterClass",a).then(function(a){0===a.stats?e(a.data.error):t()}).catch(function(t){e(t)})})).then(function(){e.loading=!1,e.$emit("hideDialog"),e.$emit("fetchData")}).catch(function(t){e.loading=!1,e.$message.error(t)}))})},closeDialog:function(){this.resetForm("ruleForm"),this.$emit("hideDialog")},resetForm:function(t){this.$refs[t].resetFields()}}},U={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{title:"添加班级",visible:t.dialogVisible},on:{close:t.closeDialog}},[a("el-form",{ref:"ruleForm",attrs:{model:t.ruleForm,"status-icon":"",rules:t.rules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"班级Id",prop:"classId"}},[a("el-input",{model:{value:t.ruleForm.classId,callback:function(e){t.$set(t.ruleForm,"classId",e)},expression:"ruleForm.classId"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"密码",prop:"password"}},[a("el-input",{model:{value:t.ruleForm.password,callback:function(e){t.$set(t.ruleForm,"password",e)},expression:"ruleForm.password"}})],1),t._v(" "),a("el-form-item",[a("el-button",{on:{click:t.closeDialog}},[t._v("取消")]),t._v(" "),a("el-button",{staticClass:"submit-btn",attrs:{type:"primary",loading:t.loading},on:{click:function(e){t.submitForm("ruleForm")}}},[t._v("提交")])],1)],1)],1)},staticRenderFns:[]};var O={name:"Home",components:{ClassCard:x,AddClassDialog:R,EnterClassDialog:a("VU/8")(N,U,!1,function(t){a("4UnJ")},"data-v-ddc96f70",null).exports,PageLoading:b},created:function(){this.fetchData()},data:function(){return{classes:[],classIds:[],moveClassIds:[],addClassDialogVisible:!1,enterClassDialogVisible:!1,moving:!1,draggableOptions:{ghostClass:"ghost-move"},moveLoading:!1,loading:!1,error:!1}},computed:{sortableClasses:function(){for(var t={},e=0;e<this.classes.length;e+=1)t[this.classes[e].classId]=this.classes[e];for(var a=[],s=0;s<this.classIds.length;s+=1)a.push(t[this.classIds[s]]);return a},sortableMoveClasses:{get:function(){for(var t={},e=0;e<this.classes.length;e+=1)t[this.classes[e].classId]=this.classes[e];for(var a=[],s=0;s<this.moveClassIds.length;s+=1)a.push(t[this.moveClassIds[s]]);return a},set:function(t){for(var e=[],a=0;a<t.length;a+=1)e.push(t[a].classId);this.moveClassIds=e}}},methods:{fetchData:function(){var t=this;this.loading=!0,this.error=!1,new h.a(function(t,e){F.get("/api/general/getClasses").then(function(a){1===a.stats?t(a.data):e(a.data.error)}).catch(function(t){e(t)})}).then(function(e){t.loading=!1,t.classes=e.classes,t.classIds=e.classIds,t.moveClassIds=e.classIds}).catch(function(e){t.loading=!1,t.error=!0,t.$message.error(e)})},addClass:function(){this.addClassDialogVisible=!0},enterClass:function(){this.enterClassDialogVisible=!0},submitMove:function(){var t,e=this;this.moveLoading=!0,(t={classIds:this.moveClassIds},new h.a(function(e,a){F.put("/api/general/moveClasses",t).then(function(t){0===t.stats?a(t.data.error):e()}).catch(function(t){a(t)})})).then(function(){e.moveLoading=!1,e.fetchData(),e.moving=!1}).catch(function(t){e.moveLoading=!1,e.$message.error(t)})},cancelMove:function(){this.moving=!1,this.moveClassIds=this.classIds}}},B={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("vue-headful",{attrs:{title:t.$route.meta.title}}),t._v(" "),t.loading||t.error?a("page-loading",{attrs:{loading:t.loading,error:t.error}}):t._e(),t._v(" "),t.loading||t.error||!t.$store.state.user.email?t._e():a("div",[a("div",{staticClass:"home-operate-container"},[a("div",{staticClass:"home-operate-content"},["teacher"===t.$store.state.user.role?a("el-button",{attrs:{type:"primary"},on:{click:t.addClass}},[t._v("新建班级")]):t._e(),t._v(" "),"student"===t.$store.state.user.role?a("el-button",{attrs:{type:"primary"},on:{click:t.enterClass}},[t._v("添加班级")]):t._e(),t._v(" "),t.moving?t._e():a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.moving=!0}}},[t._v("移动班级")]),t._v(" "),t.moving?a("el-button",{attrs:{type:"primary"},on:{click:t.cancelMove}},[t._v("放弃移动")]):t._e(),t._v(" "),t.moving?a("el-button",{attrs:{type:"primary",loading:t.moveLoading},on:{click:t.submitMove}},[t._v("提交移动")]):t._e(),t._v(" "),t.moving?a("span",{staticClass:"move-note"},[t._v("拖动下方卡片即可移动")]):t._e()],1)]),t._v(" "),t.moving?a("div",[a("vue-draggable",{attrs:{options:t.draggableOptions},model:{value:t.sortableMoveClasses,callback:function(e){t.sortableMoveClasses=e},expression:"sortableMoveClasses"}},[a("transition-group",t._l(t.sortableMoveClasses,function(e){return a("class-card",{key:e.classId,attrs:{classs:e,move:t.moving}})}))],1)],1):a("div",t._l(t.sortableClasses,function(e){return a("class-card",{key:e.classId,attrs:{classs:e,move:t.moving}})})),t._v(" "),"teacher"===t.$store.state.user.role?a("add-class-dialog",{attrs:{dialogVisible:t.addClassDialogVisible},on:{hideDialog:function(e){t.addClassDialogVisible=!1},fetchData:t.fetchData}}):t._e(),t._v(" "),"student"===t.$store.state.user.role?a("enter-class-dialog",{attrs:{dialogVisible:t.enterClassDialogVisible},on:{hideDialog:function(e){t.enterClassDialogVisible=!1},fetchData:t.fetchData}}):t._e()],1)],1)},staticRenderFns:[]};var q=a("VU/8")(O,B,!1,function(t){a("TxOr")},"data-v-95a8960a",null).exports;function z(t){return new h.a(function(e,a){F.post("/api/general/checkEmail",{email:t}).then(function(t){0===t.stats?a(t.data.error):e()}).catch(function(t){a(t)})})}function M(){return new h.a(function(t,e){F.get("/api/general/getCaptcha").then(function(a){0===a.stats?e(a.data.error):t(a.data.captcha)}).catch(function(t){e(t)})})}function G(t){return new h.a(function(e,a){F.post("/api/general/checkCaptcha",{captcha:t}).then(function(t){0===t.stats?a(t.data.error):e()}).catch(function(t){a(t)})})}function j(t){return new h.a(function(e,a){F.post("/api/general/sendEmail",t).then(function(t){0===t.stats?a(t.data.error):e()}).catch(function(t){a(t)})})}var K={name:"RegistPage",created:function(){this.getCaptchaSVG()},data:function(){var t=this;return{ruleForm:{email:"",name:"",stuId:"",password:"",checkPass:"",captcha:"",role:"student"},rules:{email:[{required:!0,validator:function(t,e,a){e?y.validEmail(e)?z(e).then(function(){a()},function(t){a(new Error(t))}):a(new Error("邮箱格式有误")):a(new Error("必填"))},trigger:"blur"}],name:[{required:!0,validator:function(t,e,a){e?a():a(new Error("必填"))},trigger:"blur"}],stuId:[{required:!0,validator:function(e,a,s){a||"student"!==t.ruleForm.role?s():s(new Error("必填"))},trigger:"blur"}],password:[{required:!0,validator:function(e,a,s){""===a?s(new Error("请输入密码")):y.validPassword2(a)?(""!==t.ruleForm.checkPass&&t.$refs.ruleForm.validateField("checkPass"),s()):s(new Error("6-20个字符,支持数字/大小写字母/标点符号,不能有空格"))},trigger:"blur"}],checkPass:[{required:!0,validator:function(e,a,s){""===a?s(new Error("请再次输入密码")):a!==t.ruleForm.password?s(new Error("两次输入密码不一致!")):s()},trigger:"blur"}],captcha:[{required:!0,validator:function(t,e,a){""===e?a(new Error("请输入验证码")):/^[a-zA-Z0-9]{4}$/.test(e)?G(e).then(function(){a()}).catch(function(t){a(new Error(t))}):a(new Error("验证码格式错误"))},trigger:"blur"}]},captchaSVG:"",success:!1,mailLoading:!1,loading:!1}},methods:{submitForm:function(t){var e=this;this.$refs[t].validate(function(t){var a;t&&(e.loading=!0,(a={name:e.ruleForm.name,stuId:e.ruleForm.stuId,email:e.ruleForm.email,password:e.ruleForm.password,role:e.ruleForm.role,captcha:e.ruleForm.captcha,host:window.location.host},new h.a(function(t,e){F.post("/api/general/regist",a).then(function(a){0===a.stats?e(a.data.error):t()}).catch(function(t){e(t)})})).then(function(){e.loading=!1,e.success=!0}).catch(function(t){e.loading=!1,e.$message.error(t),e.getCaptchaSVG()}))})},getCaptchaSVG:function(){var t=this;M().then(function(e){t.captchaSVG=e}).catch(function(e){t.captchaSVG="获取验证码失败",t.$message.error(e)})},resetForm:function(t){this.$refs[t].resetFields()},tryAgain:function(){var t=this;this.mailLoading=!0,j({email:this.ruleForm.email,host:window.location.host}).then(function(){t.$message.success("发送成功"),t.mailLoading=!1}).catch(function(e){t.$message.error(e),t.mailLoading=!1})}}},Q={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"regist-box"},[a("vue-headful",{attrs:{title:t.$route.meta.title}}),t._v(" "),t.success?a("div",{staticClass:"success-msg"},[a("span",{staticClass:"tmcu-text"},[t._v("\n      "+t._s(t.mailLoading?"":"邮件已发送到 "+t.ruleForm.email+" 邮箱激活后才能登录")+"\n    ")]),t._v(" "),a("el-button",{attrs:{type:"text",loading:t.mailLoading},on:{click:t.tryAgain}},[t._v("\n      "+t._s(t.mailLoading?"正在发送...":"没收到?重新发送")+"\n    ")])],1):a("div",[a("p",{staticClass:"regist-title"},[t._v("用户注册")]),t._v(" "),a("el-form",{ref:"ruleForm",attrs:{model:t.ruleForm,"status-icon":"",rules:t.rules,"label-width":"100px"},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key,"Enter"))return null;t.submitForm("ruleForm")}}},[a("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[a("el-input",{attrs:{"auto-complete":"on"},model:{value:t.ruleForm.email,callback:function(e){t.$set(t.ruleForm,"email",e)},expression:"ruleForm.email"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"姓名",prop:"name"}},[a("el-input",{attrs:{"auto-complete":"on"},model:{value:t.ruleForm.name,callback:function(e){t.$set(t.ruleForm,"name",e)},expression:"ruleForm.name"}})],1),t._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"student"===t.ruleForm.role,expression:"ruleForm.role === 'student'"}],attrs:{label:"学号",prop:"stuId"}},[a("el-input",{attrs:{"auto-complete":"on"},model:{value:t.ruleForm.stuId,callback:function(e){t.$set(t.ruleForm,"stuId",e)},expression:"ruleForm.stuId"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"密码",prop:"password"}},[a("el-input",{attrs:{type:"password",placeholder:"6-20个字符,数字/大小写字母/标点符号,不能有空格"},model:{value:t.ruleForm.password,callback:function(e){t.$set(t.ruleForm,"password",e)},expression:"ruleForm.password"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"确认密码",prop:"checkPass"}},[a("el-input",{attrs:{type:"password","auto-complete":"off"},model:{value:t.ruleForm.checkPass,callback:function(e){t.$set(t.ruleForm,"checkPass",e)},expression:"ruleForm.checkPass"}})],1),t._v(" "),a("el-form-item",{staticClass:"captcha-form-item",attrs:{label:"验证码",prop:"captcha"}},[a("el-input",{staticClass:"captcha-input",model:{value:t.ruleForm.captcha,callback:function(e){t.$set(t.ruleForm,"captcha",e)},expression:"ruleForm.captcha"}}),t._v(" "),a("span",{domProps:{innerHTML:t._s(t.captchaSVG)},on:{click:t.getCaptchaSVG}})],1),t._v(" "),a("el-form-item",[a("el-radio-group",{model:{value:t.ruleForm.role,callback:function(e){t.$set(t.ruleForm,"role",e)},expression:"ruleForm.role"}},[a("el-radio",{attrs:{label:"student"}},[t._v("学生")]),t._v(" "),a("el-radio",{attrs:{label:"teacher"}},[t._v("老师")])],1)],1),t._v(" "),a("el-form-item",[a("el-button",{on:{click:function(e){t.resetForm("ruleForm")}}},[t._v("重置")]),t._v(" "),a("el-button",{staticClass:"submit-btn",attrs:{type:"primary",loading:t.loading},on:{click:function(e){t.submitForm("ruleForm")}}},[t._v("提交")])],1)],1)],1)],1)},staticRenderFns:[]};var Z=a("VU/8")(K,Q,!1,function(t){a("34yC"),a("cFeA")},"data-v-cf935220",null).exports,J={name:"LoginPage",created:function(){this.getCaptchaSVG()},data:function(){return{ruleForm:{email:"",password:"",captcha:""},rules:{email:[{required:!0,validator:function(t,e,a){e?y.validEmail(e)?z(e).then(function(){a(new Error("该邮箱未注册"))},function(){a()}):a(new Error("邮箱格式有误")):a(new Error("请输入邮箱"))},trigger:"blur"}],password:[{required:!0,validator:function(t,e,a){""===e?a(new Error("请输入密码")):a()},trigger:"blur"}],captcha:[{required:!0,validator:function(t,e,a){""===e?a(new Error("请输入验证码")):y.validCaptcha(e)?G(e).then(function(){a()}).catch(function(t){a(new Error(t))}):a(new Error("验证码格式错误"))},trigger:"blur"}]},captchaSVG:"",emailNotActivate:!1,loading:!1,activateLoading:!1}},methods:{submitForm:function(t){var e=this;this.$refs[t].validate(function(t){var a;t&&(e.loading=!0,(a={email:e.ruleForm.email,password:e.ruleForm.password,captcha:e.ruleForm.captcha},new h.a(function(t,e){F.post("/api/general/login",a).then(function(a){0===a.stats?e(a.data.error):t()}).catch(function(t){e(t)})})).then(function(){e.loading=!1,e.$store.dispatch("refreshHeader").then(function(){e.$router.go(-1)})}).catch(function(t){e.loading=!1,"邮箱未激活"===t?e.emailNotActivate=!0:(e.$message.error(t),e.getCaptchaSVG())}))})},activateNow:function(){var t=this;this.activateLoading=!0,j({email:this.ruleForm.email,host:window.location.host}).then(function(){t.activateLoading=!1,t.emailNotActivate=!1,t.$message.success("邮件已发送到 "+t.ruleForm.email+" 请前往激活")}).catch(function(e){t.activateLoading=!1,t.$message.error(e)})},resetForm:function(t){this.$refs[t].resetFields()},getCaptchaSVG:function(){var t=this;M().then(function(e){t.captchaSVG=e}).catch(function(e){t.captchaSVG="获取验证码失败",t.$message.error(e)})}}},W={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"login-box"},[a("vue-headful",{attrs:{title:t.$route.meta.title}}),t._v(" "),a("p",{staticClass:"login-title"},[t._v("用户登录")]),t._v(" "),a("el-form",{ref:"ruleForm",attrs:{model:t.ruleForm,"status-icon":"",rules:t.rules,"label-width":"100px"},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key,"Enter"))return null;t.submitForm("ruleForm")}}},[a("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[a("el-input",{attrs:{"auto-complete":"on"},model:{value:t.ruleForm.email,callback:function(e){t.$set(t.ruleForm,"email",e)},expression:"ruleForm.email"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"密码",prop:"password"}},[a("el-input",{attrs:{type:"password"},model:{value:t.ruleForm.password,callback:function(e){t.$set(t.ruleForm,"password",e)},expression:"ruleForm.password"}})],1),t._v(" "),a("el-form-item",{staticClass:"captcha-form-item",attrs:{label:"验证码",prop:"captcha"}},[a("el-input",{staticClass:"captcha-input",model:{value:t.ruleForm.captcha,callback:function(e){t.$set(t.ruleForm,"captcha",e)},expression:"ruleForm.captcha"}}),t._v(" "),a("span",{domProps:{innerHTML:t._s(t.captchaSVG)},on:{click:t.getCaptchaSVG}})],1),t._v(" "),a("el-form-item",[a("el-button",{on:{click:function(e){t.resetForm("ruleForm")}}},[t._v("重置")]),t._v(" "),a("el-button",{staticClass:"submit-btn",attrs:{type:"primary",loading:t.loading},on:{click:function(e){t.submitForm("ruleForm")}}},[t._v("登录")])],1),t._v(" "),a("el-form-item",[a("router-link",{staticClass:"tmcu-btn",attrs:{to:"/forgot"}},[t._v("忘记密码?")]),t._v(" "),t.emailNotActivate?a("span",{staticClass:"email-not-activate"},[a("span",{staticClass:"email-not-activate-warnning"},[t._v("邮箱未激活")]),t._v(" "),a("el-button",{attrs:{type:"text",loading:t.activateLoading},on:{click:t.activateNow}},[t._v("立即激活")])],1):t._e()],1)],1)],1)},staticRenderFns:[]};var X=a("VU/8")(J,W,!1,function(t){a("r8ZB"),a("a7Sb")},"data-v-549348f2",null).exports,Y={name:"ForgotPassword",created:function(){this.getCaptchaSVG()},data:function(){return{success:!1,ruleForm:{email:"",captcha:""},rules:{email:[{required:!0,validator:function(t,e,a){e?y.validEmail(e)?z(e).then(function(){a(new Error("该邮箱未注册"))},function(){a()}):a(new Error("邮箱格式有误")):a(new Error("必填"))},trigger:"blur"}],captcha:[{required:!0,validator:function(t,e,a){""===e?a(new Error("请输入验证码")):y.validCaptcha(e)?G(e).then(function(){a()}).catch(function(t){a(new Error(t))}):a(new Error("验证码格式错误"))},trigger:"blur"}]},captchaSVG:"",loading:!1}},methods:{submitForm:function(t){var e=this;this.$refs[t].validate(function(t){var a;t&&(e.loading=!0,(a={email:e.ruleForm.email,captcha:e.ruleForm.captcha,host:window.location.host},new h.a(function(t,e){F.post("/api/general/forgotPass",a).then(function(a){0===a.stats?e(a.data.error):t()}).catch(function(t){e(t)})})).then(function(){e.loading=!1,e.success=!0}).catch(function(t){e.loading=!1,e.$message.error(t),e.getCaptchaSVG()}))})},resetForm:function(t){this.$refs[t].resetFields()},getCaptchaSVG:function(){var t=this;M().then(function(e){t.captchaSVG=e}).catch(function(e){t.captchaSVG="获取验证码失败",t.$message.error(e)})},tryAgain:function(){this.success=!1,this.ruleForm.email="",this.ruleForm.captcha="",this.getCaptchaSVG()}}},tt={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"login-box"},[a("vue-headful",{attrs:{title:t.$route.meta.title}}),t._v(" "),t.success?a("div",{staticClass:"success-msg"},[a("span",{staticClass:"tmcu-text"},[t._v("邮件已发送到 "+t._s(t.ruleForm.email))]),t._v(" "),a("span",{staticClass:"tmcu-btn",on:{click:t.tryAgain}},[t._v("没收到?重新尝试")])]):a("div",[a("p",{staticClass:"login-title"},[t._v("忘记密码")]),t._v(" "),a("el-form",{ref:"ruleForm",attrs:{model:t.ruleForm,"status-icon":"",rules:t.rules,"label-width":"100px"},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key,"Enter"))return null;t.submitForm("ruleForm")}}},[a("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[a("el-input",{attrs:{"auto-complete":"on"},model:{value:t.ruleForm.email,callback:function(e){t.$set(t.ruleForm,"email",e)},expression:"ruleForm.email"}})],1),t._v(" "),a("el-form-item",{staticClass:"captcha-form-item",attrs:{label:"验证码",prop:"captcha"}},[a("el-input",{staticClass:"captcha-input",model:{value:t.ruleForm.captcha,callback:function(e){t.$set(t.ruleForm,"captcha",e)},expression:"ruleForm.captcha"}}),t._v(" "),a("span",{domProps:{innerHTML:t._s(t.captchaSVG)},on:{click:t.getCaptchaSVG}})],1),t._v(" "),a("el-form-item",[a("el-button",{on:{click:function(e){t.resetForm("ruleForm")}}},[t._v("重置")]),t._v(" "),a("el-button",{staticClass:"submit-btn",attrs:{type:"primary",loading:t.loading},on:{click:function(e){t.submitForm("ruleForm")}}},[t._v("提交")])],1)],1)],1)],1)},staticRenderFns:[]};var et=a("VU/8")(Y,tt,!1,function(t){a("h2hJ"),a("lESa")},"data-v-6a94ed0c",null).exports,at={name:"ResetPassword",created:function(){var t,e=this;(t=this.$route.params.resetId,new h.a(function(e,a){F.post("/api/general/checkReset/"+t).then(function(t){0===t.stats?a(t.data.error):e()}).catch(function(t){a(t)})})).then(function(){e.valid=!0,e.invalidMsg=""}).catch(function(t){e.valid=!1,e.invalidMsg=t})},data:function(){var t=this;return{loading:!1,valid:!0,invalidMsg:"",ruleForm:{password:"",checkPass:""},rules:{password:[{required:!0,validator:function(e,a,s){""===a?s(new Error("请输入新密码")):y.validPassword2(a)?(""!==t.ruleForm.checkPass&&t.$refs.ruleForm.validateField("checkPass"),s()):s(new Error("6-20个字符，支持数字/大小写字母/标点符号,不能有空格"))},trigger:"blur"}],checkPass:[{required:!0,validator:function(e,a,s){""===a?s(new Error("请再次输入密码")):a!==t.ruleForm.password?s(new Error("两次输入密码不一致!")):s()},trigger:"blur"}]}}},methods:{submitForm:function(t){var e=this;this.$refs[t].validate(function(t){var a,s;t&&(e.loading=!0,(a=e.$route.params.resetId,s={password:e.ruleForm.password},new h.a(function(t,e){F.post("/api/general/resetPass/"+a,s).then(function(a){0===a.stats?e(a.data.error):t()}).catch(function(t){e(t)})})).then(function(){e.loading=!1,e.$message.success("重置成功，请登录"),e.$router.push("/login")}).catch(function(t){e.loading=!1,e.$message.error(t)}))})},resetForm:function(t){this.$refs[t].resetFields()}}},st={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"reset-box"},[a("vue-headful",{attrs:{title:t.$route.meta.title}}),t._v(" "),t.valid?a("div",[a("p",{staticClass:"reset-title"},[t._v("重置密码")]),t._v(" "),a("el-form",{ref:"ruleForm",attrs:{model:t.ruleForm,"status-icon":"",rules:t.rules,"label-width":"100px"},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key,"Enter"))return null;t.submitForm("ruleForm")}}},[a("el-form-item",{attrs:{label:"新密码",prop:"password"}},[a("el-input",{attrs:{type:"password",placeholder:"6-20个字符，支持数字,大小写字母和标点符号,不能有空格"},model:{value:t.ruleForm.password,callback:function(e){t.$set(t.ruleForm,"password",e)},expression:"ruleForm.password"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"确认新密码",prop:"checkPass"}},[a("el-input",{attrs:{type:"password"},model:{value:t.ruleForm.checkPass,callback:function(e){t.$set(t.ruleForm,"checkPass",e)},expression:"ruleForm.checkPass"}})],1),t._v(" "),a("el-form-item",[a("el-button",{on:{click:function(e){t.resetForm("ruleForm")}}},[t._v("重置")]),t._v(" "),a("el-button",{staticClass:"submit-btn",attrs:{type:"primary",loading:t.loading},on:{click:function(e){t.submitForm("ruleForm")}}},[t._v("提交")])],1)],1)],1):a("div",{staticClass:"invalid-msg"},[a("p",{staticClass:"tmcu-text"},[t._v(t._s(t.invalidMsg))])])],1)},staticRenderFns:[]};var it=a("VU/8")(at,st,!1,function(t){a("QJFS"),a("SdsR")},"data-v-c2b389b2",null).exports,rt={name:"ActivateEmail",data:function(){return{loading:!1}},methods:{activate:function(){var t,e=this;this.loading=!0,(t=this.$route.params.activateId,new h.a(function(e,a){F.put("/api/general/activateEmail/"+t).then(function(t){0===t.stats?a(t.data.error):e()}).catch(function(t){a(t)})})).then(function(){e.loading=!1,e.$router.push("/login"),e.$message.success("激活成功，请登录")}).catch(function(t){e.loading=!1,e.$message.error(t)})}}},nt={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"activate-mail"},[e("vue-headful",{attrs:{title:this.$route.meta.title}}),this._v(" "),e("el-button",{attrs:{loading:this.loading,type:"primary"},on:{click:this.activate}},[this._v("激活")])],1)},staticRenderFns:[]};var ot=a("VU/8")(rt,nt,!1,function(t){a("Hut3")},"data-v-07b40512",null).exports,lt={name:"Breadcrumb",props:{paths:{type:Array}}},ct={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",t._l(t.paths,function(e,s){return a("span",{key:e.name,staticClass:"breadcrumb-item"},[s?a("span",{staticClass:"separator"},[t._v("/")]):t._e(),t._v(" "),e.to?a("span",[a("router-link",{staticClass:"tmcu-btn",attrs:{to:e.to}},[t._v("\n        "+t._s(e.name)+"\n      ")])],1):a("span",{staticClass:"tmcu-text"},[t._v(t._s(e.name))])])}))},staticRenderFns:[]};var ut=a("VU/8")(lt,ct,!1,function(t){a("0tlg")},"data-v-38b6fd14",null).exports;var dt={name:"UploadFiles",model:{prop:"files",event:"change"},props:{files:{type:Array,default:function(){return[]}}},methods:{customUpload:function(t){for(var e=t.file,a=0;a<this.files.length;a+=1)if(this.files[a].name===e.name)return void this.$message.error("文件已存在");e.size>10485760?this.$message.error("文件不能大于10M"):this.files.length>=10?this.$message.error("最多只能上传10个文件"):this.$emit("change",this.files.concat(e))},removeFile:function(t){this.$emit("change",this.files.filter(function(e){return e.name!==t}))}}},mt={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-upload",{attrs:{action:"\\\\",drag:"","show-file-list":!1,"http-request":t.customUpload}},[a("i",{staticClass:"el-icon-upload"}),t._v(" "),a("div",{staticClass:"el-upload__text"},[t._v("将文件拖到此处，或"),a("em",[t._v("点击上传")])]),t._v(" "),a("div",{staticClass:"el-upload__tip"},[t._v("最多可上传10个文件，每个不能超过10M")])]),t._v(" "),a("ul",{staticClass:"file-list"},t._l(t.files,function(e){return a("li",{key:e.name,staticClass:"tmcu-text"},[a("i",{staticClass:"el-icon-document"}),t._v(" "),a("span",[t._v(t._s(e.name))]),t._v(" "),a("span",{staticClass:"tmcu-btn",on:{click:function(a){t.removeFile(e.name)}}},[a("i",{staticClass:"el-icon-close"})])])}))],1)},staticRenderFns:[]};var ft=a("VU/8")(dt,mt,!1,function(t){a("jxe7")},"data-v-36a8de1a",null).exports,ht=a("fZjL"),pt=a.n(ht),vt=a("Zrlr"),gt=a.n(vt),bt=function t(e){gt()(this,t);for(var a=new FormData,s=pt()(e),i=0;i<s.length;i+=1)if(void 0!==e[s[i]])if(y.isArray(e[s[i]]))for(var r=0;r<e[s[i]].length;r+=1)a.append(s[i],e[s[i]][r]);else a.append(s[i],e[s[i]]);return a},wt={name:"AddHomeworkDialog",props:{dialogVisible:{type:Boolean,default:!1},classId:{type:String,default:""}},components:{MarkdownEditor:E,UploadFiles:ft,FullscreenDialog:V},data:function(){var t=this,e=this;return{loading:!1,fileList:[],ruleForm:{title:"",description:"",beginDate:"",endDate:""},rules:{title:[{required:!0,validator:function(t,e,a){""===e?a(new Error("必填")):a()},trigger:"blur"}],beginDate:[{validator:function(e,a,s){t.ruleForm.endDate&&t.ruleForm.endDate.getTime()<t.ruleForm.beginDate.getTime()?s(new Error("开始时间不能晚于截止时间")):s()},trigger:"blur"}],endDate:[{validator:function(e,a,s){t.ruleForm.beginDate&&t.ruleForm.beginDate.getTime()>t.ruleForm.endDate.getTime()?s(new Error("截止时间不能早于开始时间")):s()},trigger:"blur"}]},pickerOptions1:{shortcuts:[{text:"明天",onClick:function(t){var e=new Date,a=new Date((new Date).toLocaleDateString()).getTime();e.setTime(a+864e5),t.$emit("pick",e)}},{text:"后天",onClick:function(t){var e=new Date,a=new Date((new Date).toLocaleDateString()).getTime();e.setTime(a+1728e5),t.$emit("pick",e)}},{text:"三天后",onClick:function(t){var e=new Date,a=new Date((new Date).toLocaleDateString()).getTime();e.setTime(a+2592e5),t.$emit("pick",e)}},{text:"一周后",onClick:function(t){var e=new Date,a=new Date((new Date).toLocaleDateString()).getTime();e.setTime(a+6048e5),t.$emit("pick",e)}}],disabledDate:function(t){return e.ruleForm.endDate?t.getTime()<new Date((new Date).toLocaleDateString()).getTime()||t.getTime()>new Date(e.ruleForm.endDate.toLocaleDateString()).getTime():t.getTime()<new Date((new Date).toLocaleDateString()).getTime()}},pickerOptions2:{shortcuts:[{text:"三天后",onClick:function(t){var e=new Date,a=new Date((new Date).toLocaleDateString()).getTime()-1;e.setTime(a+3456e5),t.$emit("pick",e)}},{text:"五天后",onClick:function(t){var e=new Date,a=new Date((new Date).toLocaleDateString()).getTime()-1;e.setTime(a+5184e5),t.$emit("pick",e)}},{text:"一周后",onClick:function(t){var e=new Date,a=new Date((new Date).toLocaleDateString()).getTime()-1;e.setTime(a+5184e5),t.$emit("pick",e)}},{text:"两周后",onClick:function(t){var e=new Date,a=new Date((new Date).toLocaleDateString()).getTime()-1;e.setTime(a+1296e6),t.$emit("pick",e)}}],disabledDate:function(t){return e.ruleForm.beginDate?t.getTime()<new Date(e.ruleForm.beginDate.toLocaleDateString()).getTime():t.getTime()<new Date((new Date).toLocaleDateString()).getTime()}}}},methods:{submitForm:function(t){var e=this;this.$refs[t].validate(function(t){if(t){var a=new bt({files:e.fileList,title:e.ruleForm.title,description:e.ruleForm.description,beginDate:e.ruleForm.beginDate?e.ruleForm.beginDate.getTime():"",endDate:e.ruleForm.endDate?e.ruleForm.endDate.getTime():""});e.loading=!0,(s=e.classId,i=a,new h.a(function(t,e){F.post("/api/teacher/addHw/"+s,i).then(function(a){0===a.stats?e(a.data.error):t()}).catch(function(t){e(t)})})).then(function(){e.loading=!1,e.$emit("hideDialog"),e.$emit("fetchData")}).catch(function(t){e.loading=!1,e.$message.error(t)})}var s,i})},closeDialog:function(){this.resetForm("ruleForm"),this.$emit("hideDialog")},resetForm:function(t){this.$refs[t].resetFields(),this.fileList=[]}}},_t={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("fullscreen-dialog",{attrs:{title:"创建作业",visible:t.dialogVisible},on:{close:t.closeDialog}},[a("el-form",{ref:"ruleForm",attrs:{model:t.ruleForm,"status-icon":"",rules:t.rules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"作业标题",prop:"title"}},[a("el-row",[a("el-col",{attrs:{span:22}},[a("el-input",{attrs:{placeholder:"50字以内",clearable:!0,maxlength:50},model:{value:t.ruleForm.title,callback:function(e){t.$set(t.ruleForm,"title",e)},expression:"ruleForm.title"}})],1),t._v(" "),a("el-col",{attrs:{span:2}},[a("span",{staticStyle:{"padding-left":"5px"}},[t._v(t._s(t.ruleForm.title.length)+"/50")])])],1)],1),t._v(" "),a("el-form-item",{attrs:{label:"作业详情",prop:"description"}},[a("markdown-editor",{attrs:{value:t.ruleForm.description},on:{change:function(e){return t.ruleForm.description=e}}})],1),t._v(" "),a("el-form-item",{attrs:{label:"开始时间",prop:"beginDate"}},[a("el-date-picker",{attrs:{type:"datetime",placeholder:"选择日期时间","picker-options":t.pickerOptions1},model:{value:t.ruleForm.beginDate,callback:function(e){t.$set(t.ruleForm,"beginDate",e)},expression:"ruleForm.beginDate"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"截止时间",prop:"endDate"}},[a("el-date-picker",{attrs:{type:"datetime",placeholder:"选择日期时间","default-time":"23:59:59","picker-options":t.pickerOptions2},model:{value:t.ruleForm.endDate,callback:function(e){t.$set(t.ruleForm,"endDate",e)},expression:"ruleForm.endDate"}})],1),t._v(" "),a("div",{staticClass:"form-item-upload"},[a("upload-files",{model:{value:t.fileList,callback:function(e){t.fileList=e},expression:"fileList"}})],1),t._v(" "),a("el-form-item",[a("el-button",{on:{click:t.closeDialog}},[t._v("取消")]),t._v(" "),a("el-button",{staticClass:"submit-btn",attrs:{type:"primary",loading:t.loading},on:{click:function(e){t.submitForm("ruleForm")}}},[t._v("提交")])],1)],1)],1)},staticRenderFns:[]};var Dt=a("VU/8")(wt,_t,!1,function(t){a("ZWOs")},"data-v-65013ebb",null).exports,Ft={name:"HomeworkItem",props:{homework:{type:Object,default:function(){return{}}},classId:{type:String,default:""},isTA:{type:Boolean,default:!1}},methods:{formateDate:function(t){return t?y.formateDate(+t):"--"}},computed:{expired:function(){return this.homework.beginDate&&this.homework.beginDate>Date.now()?0:this.homework.endDate&&this.homework.endDate<Date.now()?1:2}},filters:{hwStatus:function(t){return 0===t?"未开始":1===t?"已截止":"进行中"},hwTagType:function(t){return 0===t?"warning":1===t?"info":"success"},hwSubStatus:function(t){return t?"已提交":"未提交"},hwSubTagType:function(t){return t?"success":"danger"},subCheckSubStatus:function(t){return t?"已审阅":"未审阅"},subCheckTagType:function(t){return t?"success":"warning"}}},kt={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"box-card-1 box-card-2"},[a("el-card",[a("div",{staticClass:"clearfix text-line",attrs:{slot:"header"},slot:"header"},[a("router-link",{staticClass:"card-text-btn",attrs:{title:t.homework.title,to:{name:"HomeworkPage",params:{classId:t.classId,createDate:t.homework.createDate}}}},[t._v(t._s(t.homework.title))]),t._v(" "),a("el-tag",{staticClass:"hw-status",attrs:{size:"mini",type:t._f("hwTagType")(t.expired)}},[t._v("\n        "+t._s(t._f("hwStatus")(t.expired))+"\n      ")])],1),t._v(" "),a("div",[a("el-form",{attrs:{"label-width":"80px",size:"small"}},[a("el-form-item",{attrs:{label:"创建时间:"}},[t._v("\n          "+t._s(t.formateDate(t.homework.createDate))+"\n        ")]),t._v(" "),a("el-form-item",{attrs:{label:"开始时间:"}},[t._v("\n          "+t._s(t.formateDate(t.homework.beginDate))+"\n        ")]),t._v(" "),a("el-form-item",{attrs:{label:"结束时间:"}},[t._v("\n          "+t._s(t.formateDate(t.homework.endDate))+"\n        ")]),t._v(" "),a("el-form-item",{attrs:{label:"提交人数:"}},[t._v("\n          "+t._s(t.homework.amountOfSubs)+"\n        ")])],1),t._v(" "),"student"!==t.$store.state.user.role||t.isTA?t._e():a("div",{staticClass:"stu-hw-status"},[a("el-tag",{attrs:{size:"mini",type:t._f("hwSubTagType")(t.homework.submit)}},[t._v("\n          "+t._s(t._f("hwSubStatus")(t.homework.submit))+"\n        ")]),t._v(" "),a("el-tag",{attrs:{size:"mini",type:t._f("subCheckTagType")(t.homework.checked)}},[t._v("\n          "+t._s(t._f("subCheckSubStatus")(t.homework.checked))+"\n        ")])],1)],1)])],1)},staticRenderFns:[]};var $t=a("VU/8")(Ft,kt,!1,function(t){a("Q0sH")},"data-v-d47e6c08",null).exports,Ct={name:"FileList",props:{files:{type:Array,default:function(){return[]},required:!0}}},xt={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[t.files.length?a("p",{staticClass:"note tmcu-text"},[t._v("附件：")]):t._e(),t._v(" "),a("ul",{staticClass:"file-list"},t._l(t.files,function(e){return a("li",{key:e.filename},[a("a",{staticClass:"tmcu-btn",attrs:{href:"/api/general/download/"+e.filename+"/"+e.name}},[a("i",{staticClass:"el-icon-document"}),t._v(" "),a("span",[t._v(t._s(e.name))])])])}))])},staticRenderFns:[]};var yt=a("VU/8")(Ct,xt,!1,function(t){a("a3j2")},"data-v-6f99cb1a",null).exports,St=a("ifQC"),It={name:"ViewStuSubsDialog",components:{MarkdownEditor:E,FileList:yt,FullscreenDialog:V},computed:{dvRows:function(){for(var t=[{name:"已提交"},{name:"未提交"}],e=[],a=0;a<this.submissions.length;a+=1)!0===this.submissions[a].commit?(t[0][this.submissions[a].hwTitle]=1,t[1][this.submissions[a].hwTitle]=0):(t[0][this.submissions[a].hwTitle]=0,t[1][this.submissions[a].hwTitle]=1),e.push(this.submissions[a].hwTitle);var s=(new St.View).source(t);return s.transform({type:"fold",fields:e,key:"hwTitle",value:"commit"}),s.rows}},data:function(){return{submissions:[],classId:"",userId:"",stuName:"",stuId:"",subDetail:{},showDetail:!1,visible:!1,loading:!1,scale:[{dataKey:"hwTitle",alias:"作业名称"}],labels:{formatter:function(t){return t.length>6?t.slice(0,5)+"..":t}},height:400}},methods:{show:function(t,e,a,s){var i=this;this.visible=!0,this.loading=!0,this.showDetail=!1,this.stuName=a,this.stuId=s,this.classId=t,this.userId=e,function(t,e){return new h.a(function(a,s){F.get("/api/teacher/getStuSubs",{classId:t,userId:e}).then(function(t){1===t.stats?a(t.data.subs):s(t.data.error)}).catch(function(t){s(t)})})}(t,e).then(function(t){i.submissions=t,i.loading=!1}).catch(function(t){i.loading=!1,i.$message.error(t)})},showSubDetail:function(t){if("已提交"===t.data._origin.name){for(var e=0;e<this.submissions.length;e+=1)if(this.submissions[e].hwTitle===t.data._origin.hwTitle){var a=this.submissions[e];this.subDetail={hwTitle:a.hwTitle,date:a.date,answer:a.answer,files:a.files,checked:a.checked,feedback:a.feedback};break}this.showDetail=!0}else this.showDetail=null},formateDate:function(t){return t?y.formateDate(+t):"--"},closeDialog:function(){this.visible=!1}}},Tt={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("fullscreen-dialog",{attrs:{title:t.stuName+"("+t.stuId+")-所有作业提交的数据统计",visible:t.visible},on:{close:t.closeDialog}},[a("el-row",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}]},[a("v-chart",{attrs:{forceFit:!0,height:t.height,data:t.dvRows,scale:t.scale}},[a("v-tooltip",{attrs:{itemTpl:"<li></li>"}}),t._v(" "),a("v-axis",{attrs:{dataKey:"hwTitle",label:t.labels,title:!0}}),t._v(" "),a("v-axis",{attrs:{dataKey:"commit",label:null,line:null}}),t._v(" "),a("v-legend",{attrs:{clickable:!1}}),t._v(" "),a("v-stack-bar",{attrs:{position:"hwTitle*commit",color:"name",onClick:t.showSubDetail}})],1)],1),t._v(" "),a("p",[t._v("温馨提示: 点击柱状图查看每次作业的提交详情")]),t._v(" "),t.showDetail?a("div",[a("p",[t._v("作业: "+t._s(t.subDetail.hwTitle))]),t._v(" "),a("p",[a("span",[t._v("提交时间: "+t._s(t.formateDate(t.subDetail.date)))])]),t._v(" "),a("div",[t.subDetail.checked?a("p",[a("span",[t._v("已审阅")]),t._v(" "),a("span",[t._v("反馈结果: "+t._s(t.subDetail.feedback||"无"))])]):a("p",[t._v("未审阅")])]),t._v(" "),a("div",[a("p",[t._v("提交内容:")]),t._v(" "),a("markdown-editor",{attrs:{value:t.subDetail.answer,edit:!1}}),t._v(" "),a("file-list",{attrs:{files:t.subDetail.files}})],1)]):t._e(),t._v(" "),null===t.showDetail?a("p",[t._v("学生尚未提交")]):t._e()],1)},staticRenderFns:[]};var Et=a("VU/8")(It,Tt,!1,function(t){a("mtQr")},"data-v-c2e49654",null).exports,Lt={name:"StudentsTable",props:{students:{type:Array,default:function(){return[]}},classId:{type:String,default:""}},components:{ViewStuSubsDialog:Et},methods:{viewStudentHwsSubs:function(t){this.$refs.viewStuSubsDialogRef.show(this.classId,t.userId,t.name,t.stuId)}}},At={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.students,stripe:""}},[a("el-table-column",{attrs:{prop:"stuId",label:"学号"}}),t._v(" "),a("el-table-column",{attrs:{prop:"name",label:"姓名"}}),t._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){t.viewStudentHwsSubs(e.row)}}},[t._v("查看作业提交统计")])]}}])})],1),t._v(" "),a("view-stu-subs-dialog",{ref:"viewStuSubsDialogRef"})],1)},staticRenderFns:[]};var Vt=a("VU/8")(Lt,At,!1,function(t){a("WKXR")},null,null).exports,Pt=a("mvHQ"),Ht=a.n(Pt),Rt={name:"Courseware",components:{UploadFiles:ft,FileList:yt},props:{coursewares:{type:Array},classId:{type:String}},computed:{reverseCoursewares:function(){return this.coursewares.map(function(t){return{title:t.title,uploadDate:t.uploadDate,files:t.files.concat()}}).reverse()}},data:function(){return{fileList:[],title:"",editingCourseware:null,loading:!1}},methods:{editCourseware:function(t){this.editingCourseware=t,this.title=t.title,this.fileList=t.files},quitEditCourseware:function(){this.editingCourseware=null,this.title="",this.fileList=[]},submitCourseware:function(){var t=this,e=this.fileList.filter(function(t){return y.isFile(t)}),a=this.fileList.filter(function(t){return y.isPureObject(t)});this.loading=!0;var s,i,r=new bt({files:e,existFiles:Ht()(a),title:this.title});(s=this.classId,i=r,new h.a(function(t,e){F.post("/api/teacher/uploadCourseware/"+s,i).then(function(a){0===a.stats?e(a.data.error):t()}).catch(function(t){e(t)})})).then(function(){t.$emit("fetchData"),t.title="",t.fileList=[],t.loading=!1}).catch(function(e){t.loading=!1,t.$message.error(e)})},updateCourseware:function(){var t=this,e=this.fileList.filter(function(t){return y.isFile(t)}),a=this.fileList.filter(function(t){return y.isPureObject(t)});this.loading=!0;var s,i,r,n=new bt({files:e,existFiles:Ht()(a),title:this.title});(s=this.classId,i=this.editingCourseware.uploadDate,r=n,new h.a(function(t,e){F.put("/api/teacher/updateCourseware/"+s+"/"+i,r).then(function(a){0===a.stats?e(a.data.error):t()}).catch(function(t){e(t)})})).then(function(){t.$emit("fetchData"),t.editingCourseware=null,t.title="",t.fileList=[],t.loading=!1}).catch(function(e){t.loading=!1,t.$message.error(e)})},deleteCourseware:function(t){var e=this;this.$confirm("确认删除课件-"+t.title+"?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var a,s,i,r=e.$loading({lock:!0,text:"正在删除...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});(a=e.classId,s=t.uploadDate,new h.a(function(t,e){F.put("/api/teacher/deleteCourseware/"+a+"/"+s,i).then(function(a){0===a.stats?e(a.data.error):t()}).catch(function(t){e(t)})})).then(function(){r.close(),e.$emit("fetchData"),e.$message.success("删除成功")}).catch(function(t){r.close(),e.$message.error(t)})}).catch(function(){})},formateDate:function(t){return t?y.formateDate(+t):"--"}}},Nt={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"courseware"},[a("el-row",[a("el-col",{attrs:{span:12}},[a("div",t._l(t.reverseCoursewares,function(e){return a("div",{key:e.uploadDate,staticClass:"courseware-item"},[a("div",[a("span",{staticClass:"courseware-title"},[t._v(t._s(e.title||"无标题"))]),t._v(" "),"teacher"===t.$store.state.user.role?a("span",[a("span",{staticClass:"tmcu-btn",on:{click:function(a){t.editCourseware(e)}}},[t._v("编辑")]),t._v(" "),a("span",{staticClass:"tmcu-btn",on:{click:function(a){t.deleteCourseware(e)}}},[t._v("删除")])]):t._e()]),t._v(" "),a("p",{staticClass:"tmcu-text"},[t._v(t._s(t.formateDate(e.uploadDate)))]),t._v(" "),a("file-list",{attrs:{files:e.files}})],1)}))]),t._v(" "),a("el-col",{attrs:{span:12}},["teacher"===t.$store.state.user.role?a("div",{staticClass:"edit-courseware"},[a("p",{staticClass:"courseware-title"},[t._v("\n          "+t._s(t.editingCourseware?"编辑课件-"+(t.editingCourseware.title||"无标题"):"新增课件")+"\n        ")]),t._v(" "),a("el-input",{staticClass:"edit-title",attrs:{placeholder:"标题(可选)"},model:{value:t.title,callback:function(e){t.title=e},expression:"title"}}),t._v(" "),a("upload-files",{model:{value:t.fileList,callback:function(e){t.fileList=e},expression:"fileList"}}),t._v(" "),t.editingCourseware?a("div",{staticClass:"edit-courseware-btn"},[a("el-button",{attrs:{loading:t.loading},on:{click:t.updateCourseware}},[t._v("提交修改")]),t._v(" "),a("el-button",{on:{click:t.quitEditCourseware}},[t._v("放弃修改，新增课件")])],1):a("div",{staticClass:"edit-courseware-btn"},[a("el-button",{attrs:{loading:t.loading},on:{click:t.submitCourseware}},[t._v("提交")])],1)],1):t._e()])],1)],1)},staticRenderFns:[]};var Ut=a("VU/8")(Rt,Nt,!1,function(t){a("8eQQ")},"data-v-cf0abd82",null).exports,Ot={name:"EditClassDialog",components:{MarkdownEditor:E,FullscreenDialog:V},data:function(){return{classId:"",visible:!1,loading:!1,ruleForm:{name:"",teacherName:"",password:"",message:""},rules:{name:[{required:!0,validator:function(t,e,a){""===e?a(new Error("必填")):a()},trigger:"blur"}],password:[{required:!0,validator:function(t,e,a){""===e?a(new Error("请输入密码")):y.validClassPass(e)?a():a(new Error("6-20个字符"))},trigger:"blur"}]}}},methods:{show:function(t){this.classId=t.classId,this.ruleForm.name=t.name,this.ruleForm.teacherName=t.teacherName,this.ruleForm.password=t.password,this.ruleForm.message=t.message,this.visible=!0},submitForm:function(t){var e=this;this.$refs[t].validate(function(t){var a,s;t&&(e.loading=!0,(a=e.classId,s={name:e.ruleForm.name,teacherName:e.ruleForm.teacherName,password:e.ruleForm.password,message:e.ruleForm.message},new h.a(function(t,e){F.put("/api/teacher/editClass/"+a,s).then(function(a){0===a.stats?e(a.data.error):t()}).catch(function(t){e(t)})})).then(function(){e.visible=!1,e.loading=!1,e.$emit("fetchData")}).catch(function(t){e.loading=!1,e.$message.error(t)}))})},closeDialog:function(){this.visible=!1,this.$refs.ruleForm.clearValidate()}}},Bt={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("fullscreen-dialog",{attrs:{title:"修改班级信息",visible:t.visible},on:{close:t.closeDialog}},[a("el-form",{ref:"ruleForm",attrs:{model:t.ruleForm,"status-icon":"",rules:t.rules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"班级Id"}},[a("p",[t._v(t._s(t.classId))])]),t._v(" "),a("el-form-item",{attrs:{label:"密码",prop:"password"}},[a("el-input",{attrs:{maxlength:20,placeholder:"公开给班里学生，6-20个字符"},model:{value:t.ruleForm.password,callback:function(e){t.$set(t.ruleForm,"password",e)},expression:"ruleForm.password"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"班级名称",prop:"name"}},[a("el-row",[a("el-col",{attrs:{span:20}},[a("el-input",{attrs:{placeholder:"30字以内",clearable:!0,maxlength:30},model:{value:t.ruleForm.name,callback:function(e){t.$set(t.ruleForm,"name",e)},expression:"ruleForm.name"}})],1),t._v(" "),a("el-col",{attrs:{span:4}},[a("span",{staticStyle:{"padding-left":"5px"}},[t._v(t._s(t.ruleForm.name.length)+"/30")])])],1)],1),t._v(" "),a("el-form-item",{attrs:{label:"其他信息",prop:"message"}},[a("markdown-editor",{attrs:{value:t.ruleForm.message},on:{change:function(e){return t.ruleForm.message=e}}})],1),t._v(" "),a("el-form-item",{attrs:{label:"任课教师",prop:"teacherName"}},[a("el-input",{attrs:{"auto-complete":"on"},model:{value:t.ruleForm.teacherName,callback:function(e){t.$set(t.ruleForm,"teacherName",e)},expression:"ruleForm.teacherName"}})],1),t._v(" "),a("el-form-item",[a("el-button",{on:{click:t.closeDialog}},[t._v("取消")]),t._v(" "),a("el-button",{staticClass:"submit-btn",attrs:{type:"primary",loading:t.loading},on:{click:function(e){t.submitForm("ruleForm")}}},[t._v("提交")])],1)],1)],1)},staticRenderFns:[]};var qt=a("VU/8")(Ot,Bt,!1,function(t){a("lnvI")},"data-v-4f148f0e",null).exports,zt={name:"ViewAllSubsDialog",components:{FullscreenDialog:V},data:function(){var t=this;return{homeworks:[],visible:!1,scale:[{dataKey:"amountOfSubs",alias:"提交人数",tickInterval:1,min:0},{dataKey:"title",alias:"作业名称"},{dataKey:"createDate",alias:"创建时间",formatter:function(e){return t.formateDate(e)}},{dataKey:"beginDate",alias:"开始时间",formatter:function(e){return t.formateDate(e)}},{dataKey:"endDate",alias:"截止时间",formatter:function(e){return t.formateDate(e)}}],crosshairs:{type:"line"},labels:{formatter:function(t){return t.length>6?t.slice(0,5)+"..":t}},axisLine:{lineWidth:2,stroke:"#dedede"},tickLine:{lineWidth:1,stroke:"#d1d1d1",strokeOpacity:1,length:5},height:400}},methods:{show:function(t){this.homeworks=t,this.visible=!0},formateDate:function(t){return t?y.formateDate(+t):"--"},closeDialog:function(){this.visible=!1}}},Mt={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("fullscreen-dialog",{attrs:{title:"所有作业提交的数据统计",visible:t.visible},on:{close:t.closeDialog}},[a("v-chart",{attrs:{forceFit:!0,height:t.height,data:t.homeworks,scale:t.scale}},[a("v-tooltip",{attrs:{crosshairs:t.crosshairs,showTitle:!1}}),t._v(" "),a("v-axis",{attrs:{dataKey:"title",label:t.labels,title:!0}}),t._v(" "),a("v-axis",{attrs:{dataKey:"amountOfSubs",line:t.axisLine,tickLine:t.tickLine,title:!0}}),t._v(" "),a("v-line",{attrs:{position:"title*amountOfSubs",tooltip:"title*createDate*beginDate*endDate*amountOfSubs"}}),t._v(" "),a("v-point",{attrs:{position:"title*amountOfSubs",shape:"circle"}})],1)],1)},staticRenderFns:[]};var Gt=a("VU/8")(zt,Mt,!1,function(t){a("gI/P")},"data-v-482f97be",null).exports,jt={name:"ClassTasDialog",props:{classId:{type:String,default:""}},data:function(){return{tas:[],visible:!1,loading:!1,editing:!1,taName:"",taEmail:""}},methods:{show:function(t){this.tas=t,this.visible=!0,this.editing=!t.length,this.taName="",this.taEmail=""},submitClassTas:function(){var t,e,a=this;this.loading=!0,(t=this.classId,e={tas:this.tas},new h.a(function(a,s){F.put("/api/teacher/updateClassTas/"+t,e).then(function(t){0===t.stats?s(t.data.error):a()}).catch(function(t){s(t)})})).then(function(){a.loading=!1,a.editing=!1,a.taName="",a.taEmail="",a.$emit("fetchData")}).catch(function(t){a.loading=!1,a.$message.error(t)})},removeTa:function(t){this.tas=this.tas.filter(function(e){return e.email!==t})},addNewTa:function(){""===this.taName||""===this.taEmail?this.$message.error("表单信息不能为空"):(this.tas.push({name:this.taName,email:this.taEmail}),this.taName="",this.taEmail="")},closeDialog:function(){this.visible=!1}}},Kt={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{title:"助教",visible:t.visible},on:{close:t.closeDialog}},[t.editing?t._e():a("div",["teacher"===t.$store.state.user.role?a("div",[a("el-button",{attrs:{type:"text"},on:{click:function(e){t.editing=!0}}},[t._v("编辑")])],1):t._e(),t._v(" "),t._l(t.tas,function(e){return a("div",{key:e.email},[a("span",{staticClass:"tmcu-text"},[t._v(t._s(e.name)+":")]),t._v(" "),a("a",{staticClass:"mail-btn",attrs:{href:"mailto:"+e.email}},[t._v(t._s(e.email))])])})],2),t._v(" "),t.editing&&"teacher"===t.$store.state.user.role?a("div",[t._l(t.tas,function(e){return a("div",{key:e.email},[a("span",{staticClass:"tmcu-text"},[t._v(t._s(e.name)+": "+t._s(e.email))]),t._v(" "),a("el-button",{attrs:{type:"text",icon:"el-icon-close"},on:{click:function(a){t.removeTa(e.email)}}})],1)}),t._v(" "),a("br"),t._v(" "),a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:4}},[a("span",{staticClass:"tmcu-text"},[t._v("新增助教:")])]),t._v(" "),a("el-col",{attrs:{span:7}},[a("el-input",{attrs:{size:"small",placeholder:"助教姓名"},model:{value:t.taName,callback:function(e){t.taName=e},expression:"taName"}})],1),t._v(" "),a("el-col",{attrs:{span:10}},[a("el-input",{attrs:{size:"small",placeholder:"助教邮箱"},model:{value:t.taEmail,callback:function(e){t.taEmail=e},expression:"taEmail"}})],1),t._v(" "),a("el-col",{attrs:{span:3}},[a("el-button",{attrs:{type:"text"},on:{click:t.addNewTa}},[t._v("添加")])],1)],1),t._v(" "),a("br"),t._v(" "),a("div",[a("el-button",{attrs:{type:"primary",loading:t.loading},on:{click:t.submitClassTas}},[t._v("提交")])],1)],2):t._e()])},staticRenderFns:[]};var Qt={name:"ClassPage",created:function(){this.fetchData()},components:{AddHomeworkDialog:Dt,HomeworkItem:$t,StudentsTable:Vt,CoursewarePane:Ut,MarkdownEditor:E,EditClassDialog:qt,ViewAllSubsDialog:Gt,ViewStuSubsDialog:Et,ClassTasDialog:a("VU/8")(jt,Kt,!1,function(t){a("5gYu")},"data-v-2cb46171",null).exports,PageLoading:b,Breadcrumb:ut},data:function(){return{classs:{classId:"",name:"",teacherName:"",password:"",message:"",students:[],homeworks:[],coursewares:[],tas:[]},activeTabName:"homework",addHwDialogVisible:!1,loading:!1,error:!1}},computed:{reverseHomeworks:function(){return this.classs.homeworks.slice().reverse()},isTA:function(){for(var t=this.$store.state.user.email,e=0;e<this.classs.tas.length;e+=1)if(this.classs.tas[e].email===t)return!0;return!1}},methods:{fetchData:function(){var t,e=this;this.loading=!0,this.error=!1,(t=this.$route.params.classId,new h.a(function(e,a){F.get("/api/general/getHws",{classId:t}).then(function(t){1===t.stats?e(t.data.class):a(t.data.error)}).catch(function(t){a(t)})})).then(function(t){e.loading=!1,e.classs=t}).catch(function(t){e.loading=!1,e.error=!0,e.$message.error(t)})},addHomework:function(){this.addHwDialogVisible=!0},showEditClassDialog:function(){this.$refs.editClassDialogRef.show(this.classs)},viewAllSubs:function(){this.$refs.viewAllSubsDialogRef.show(this.classs.homeworks)},viewStudentHwsSubs:function(){this.$refs.viewStuSubsDialogRef.show(this.classs.classId,this.classs.students[0].userId,this.classs.students[0].name,this.classs.students[0].stuId)},showClassTasDialog:function(){this.$refs.classTasDialogRef.show(this.classs.tas)}},filters:{taStatus:function(t,e){return e?"查看助教":"student"===t?"暂无助教":"添加助教"}}},Zt={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("vue-headful",{attrs:{title:t.$route.meta.title}}),t._v(" "),t.loading||t.error?a("page-loading",{attrs:{loading:t.loading,error:t.error}}):t._e(),t._v(" "),!t.loading&&!t.error&&t.$store.state.user.email&&t.classs.classId?a("div",[a("div",[a("div",{staticClass:"custom-card"},[a("div",[a("breadcrumb",{staticClass:"breadcrumb",attrs:{paths:[{name:"主页",to:"/"},{name:"班级"}]}}),t._v(" "),a("span",{staticClass:"class-name"},[t._v(t._s(t.classs.name))]),t._v(" "),"teacher"===t.$store.state.user.role?a("span",[a("el-button",{staticClass:"el-text-btn",attrs:{type:"text"},on:{click:function(e){t.showEditClassDialog()}}},[a("span",[t._v("编辑班级信息")]),t._v(" "),a("i",{staticClass:"el-icon-edit"})])],1):t._e(),t._v(" "),a("span",{staticClass:"class-ta tmcu-btn",on:{click:function(e){t.showClassTasDialog()}}},[t._v("\n            "+t._s(t._f("taStatus")(t.$store.state.user.role,t.classs.tas.length))+"\n          ")])],1),t._v(" "),a("p",[a("span",{staticClass:"class-info tmcu-text"},[t._v("班级Id："+t._s(t.classs.classId))]),t._v(" "),a("span",{staticClass:"class-info tmcu-text"},[t._v("密码："+t._s(t.classs.password))]),t._v(" "),a("span",{staticClass:"class-info tmcu-text"},[t._v("任课教师："+t._s(t.classs.teacherName))])])]),t._v(" "),t.classs.message?a("markdown-editor",{attrs:{value:t.classs.message,edit:!1}}):t._e()],1),t._v(" "),a("el-tabs",{model:{value:t.activeTabName,callback:function(e){t.activeTabName=e},expression:"activeTabName"}},[a("el-tab-pane",{attrs:{label:"作业",name:"homework"}},[a("div",{staticClass:"hw-container"},["teacher"===t.$store.state.user.role||t.isTA?a("div",{staticClass:"hw-content"},[a("span",{staticClass:"hw-total"},[t._v("作业数量: "+t._s(t.classs.homeworks.length))]),t._v(" "),t.isTA?t._e():a("el-button",{attrs:{type:"primary"},on:{click:t.addHomework}},[t._v("创建作业")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.viewAllSubs}},[t._v("数据统计")])],1):a("div",{staticClass:"hw-content"},[a("span",{staticClass:"hw-total"},[t._v("作业数量: "+t._s(t.classs.homeworks.length))]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.viewStudentHwsSubs}},[t._v("数据统计")])],1)]),t._v(" "),a("div",t._l(t.reverseHomeworks,function(e){return a("homework-item",{key:e.createDate,attrs:{classId:t.classs.classId,homework:e,isTA:t.isTA}})}))]),t._v(" "),a("el-tab-pane",{attrs:{label:"课件",name:"courseware"}},[a("courseware-pane",{attrs:{coursewares:t.classs.coursewares,classId:t.classs.classId},on:{fetchData:t.fetchData}})],1),t._v(" "),"teacher"===t.$store.state.user.role||t.isTA?a("el-tab-pane",{attrs:{label:"学生",name:"student"}},[a("p",[t._v("学生数量: "+t._s(t.classs.students.length))]),t._v(" "),a("div",[a("students-table",{attrs:{students:t.classs.students,classId:t.classs.classId}})],1)]):t._e()],1),t._v(" "),a("add-homework-dialog",{attrs:{dialogVisible:t.addHwDialogVisible,classId:t.classs.classId},on:{hideDialog:function(e){t.addHwDialogVisible=!1},fetchData:t.fetchData}}),t._v(" "),a("edit-class-dialog",{ref:"editClassDialogRef",on:{fetchData:t.fetchData}}),t._v(" "),a("view-all-subs-dialog",{ref:"viewAllSubsDialogRef"}),t._v(" "),a("view-stu-subs-dialog",{ref:"viewStuSubsDialogRef"}),t._v(" "),a("class-tas-dialog",{ref:"classTasDialogRef",attrs:{classId:t.classs.classId},on:{fetchData:t.fetchData}})],1):t._e()],1)},staticRenderFns:[]};var Jt=a("VU/8")(Qt,Zt,!1,function(t){a("dBIN")},"data-v-1f9b3356",null).exports,Wt={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("vue-headful",{attrs:{title:this.$route.meta.title}}),this._v(" "),e("div",{staticClass:"owText"},[this._v("404")])],1)},staticRenderFns:[]};var Xt=a("VU/8")({name:"NotFound"},Wt,!1,function(t){a("8+uP")},"data-v-34e036f7",null).exports;function Yt(t,e){return new h.a(function(a,s){F.get("/api/general/getSubs",{classId:t,createDate:e}).then(function(t){1===t.stats?a(t.data.homework):s(t.data.error)}).catch(function(t){s(t)})})}var te={name:"ShowStuSubDialog",props:{classId:{type:String,default:""},createDate:{type:String,default:Date.now()}},components:{MarkdownEditor:E,FileList:yt,FullscreenDialog:V},data:function(){return{visible:!1,submission:{userId:"",stuId:"",stuName:"",email:"",date:"",answer:"",file:"",checked:!1,feedback:""},feedback:"",loading:!1}},methods:{closeDialog:function(){this.visible=!1},show:function(t){this.visible=!0,this.submission.userId=t.userId,this.submission.stuId=t.stuId,this.submission.stuName=t.stuName,this.submission.email=t.email,this.submission.date=t.date,this.submission.answer=t.answer,this.submission.files=t.files,this.submission.checked=t.checked,this.submission.feedback=t.feedback},submitFeedback:function(){var t,e,a,s,i=this;this.loading=!0,(t=this.classId,e=this.createDate,a=this.submission.userId,s=this.feedback,new h.a(function(i,r){F.put("/api/teacher/feedbackHw/"+t+"/"+e+"/"+a,{feedback:s}).then(function(t){0===t.stats?r(t.data.error):i()}).catch(function(t){r(t)})})).then(function(){i.loading=!1,i.visible=!1,i.$emit("fetchData")}).catch(function(t){i.loading=!1,i.$message.error(t)})},formateDate:function(t){return t?y.formateDate(+t):"--"}}},ee={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("fullscreen-dialog",{attrs:{title:t.submission.stuName+"("+t.submission.stuId+")提交详情",visible:t.visible},on:{close:t.closeDialog}},[a("div",[t.submission.checked?a("p",[a("el-tag",{attrs:{size:"small"}},[t._v("已审阅")]),t._v(" "),a("span",[t._v("反馈结果: "+t._s(t.submission.feedback||"无"))])],1):a("p",[a("el-tag",{attrs:{type:"warning",size:"small"}},[t._v("未审阅")])],1)]),t._v(" "),a("br"),t._v(" "),a("p",[t._v("提交时间: "+t._s(t.formateDate(t.submission.date)))]),t._v(" "),a("div",[a("markdown-editor",{attrs:{value:t.submission.answer,edit:!1}}),t._v(" "),a("file-list",{attrs:{files:t.submission.files}})],1),t._v(" "),a("br"),t._v(" "),t.submission.checked?t._e():a("div",[a("div",[a("p",[t._v("填写反馈:")]),t._v(" "),a("el-input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:10},placeholder:"请输入反馈（可选）"},model:{value:t.feedback,callback:function(e){t.feedback=e},expression:"feedback"}})],1),t._v(" "),a("br"),t._v(" "),a("div",{staticClass:"submit-btn"},[a("el-button",{attrs:{type:"primary",loading:t.loading},on:{click:t.submitFeedback}},[t._v("提交")])],1)])])},staticRenderFns:[]};var ae=a("VU/8")(te,ee,!1,function(t){a("z6Ih")},"data-v-65ceaf76",null).exports,se={name:"SubmissionsTable",props:{submissions:{type:Array,default:function(){return[]}},classId:{type:String,default:""},createDate:{type:String,default:Date.now()}},components:{ShowStuSubDialog:ae},methods:{viewStudentHwSub:function(t){this.$refs.showStuSubDialogRef.show(t)},formatterDate:function(t,e,a){return this.formateDate(a)},formatterStatus:function(t){return t?"已审阅":"未审阅"},formatterFeedback:function(t,e,a){return t.checked&&a||t.checked&&"无"||"--"},formateDate:function(t){return t?y.formateDate(+t):"--"}}},ie={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.submissions,stripe:""}},[a("el-table-column",{attrs:{prop:"stuId",label:"学号"}}),t._v(" "),a("el-table-column",{attrs:{prop:"stuName",label:"姓名"}}),t._v(" "),a("el-table-column",{attrs:{prop:"date",label:"提交时间",formatter:t.formatterDate}}),t._v(" "),a("el-table-column",{attrs:{prop:"checked",label:"状态"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tag",{attrs:{type:e.row.checked?"":"warning",size:"small"}},[t._v("\n          "+t._s(t.formatterStatus(e.row.checked))+"\n        ")])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"feedback",label:"反馈",formatter:t.formatterFeedback}}),t._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){t.viewStudentHwSub(e.row)}}},[t._v("查看")])]}}])})],1),t._v(" "),a("show-stu-sub-dialog",{ref:"showStuSubDialogRef",attrs:{classId:t.classId,createDate:t.createDate},on:{fetchData:function(e){t.$emit("fetchData")}}})],1)},staticRenderFns:[]};var re=a("VU/8")(se,ie,!1,function(t){a("N7mK")},null,null).exports,ne={name:"SubmitHomework",components:{MarkdownEditor:E,UploadFiles:ft},props:{classId:{type:String,default:""},createDate:{type:String,default:Date.now()},text:{type:String,default:Date.now()},files:{type:Array,default:function(){return[]}},editing:{type:Boolean,default:!1},draft:{type:Object,default:function(){return null}}},data:function(){return{answer:this.text,fileList:this.files,loading:!1,draftLoading:!1}},methods:{submitAnswer:function(){var t,e,a,s=this,i=new bt({files:this.fileList,answer:this.answer});this.loading=!0,(t=this.classId,e=this.createDate,a=i,new h.a(function(s,i){F.post("/api/student/submitHw/"+t+"/"+e,a).then(function(t){0===t.stats?i(t.data.error):s()}).catch(function(t){i(t)})})).then(function(){s.loading=!1,s.$emit("fetchData")}).catch(function(t){s.loading=!1,s.$message.error(t)})},updateAnswer:function(){var t,e,a,s=this,i=this.fileList.filter(function(t){return y.isFile(t)}),r=this.fileList.filter(function(t){return y.isPureObject(t)}),n=new bt({files:i,existFiles:Ht()(r),answer:this.answer});this.loading=!0,(t=this.classId,e=this.createDate,a=n,new h.a(function(s,i){F.put("/api/student/editHwSub/"+t+"/"+e,a).then(function(t){0===t.stats?i(t.data.error):s()}).catch(function(t){i(t)})})).then(function(){s.loading=!1,s.$emit("fetchData")}).catch(function(t){s.loading=!1,s.$message.error(t)})},resetAnswer:function(){this.answer="",this.fileList=[]},readDraft:function(){this.answer=this.draft.answer,this.fileList=this.draft.files},storageDraft:function(){var t,e,a,s=this,i=this.fileList.filter(function(t){return y.isFile(t)}),r=this.fileList.filter(function(t){return y.isPureObject(t)}),n=new bt({files:i,existFiles:Ht()(r),answer:this.answer});this.draftLoading=!0,(t=this.classId,e=this.createDate,a=n,new h.a(function(s,i){F.put("/api/student/updateHwDraft/"+t+"/"+e,a).then(function(t){0===t.stats?i(t.data.error):s()}).catch(function(t){i(t)})})).then(function(){s.draftLoading=!1,s.$message.success("保存成功"),s.$emit("fetchDataByDraft")}).catch(function(t){s.draftLoading=!1,s.$message.error(t)})}}},oe={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"submit-homework"},[a("div",{staticClass:"draft-btns"},[this.draft?a("el-button",{attrs:{type:"text"},on:{click:t.readDraft}},[t._v("读取草稿")]):t._e(),t._v(" "),a("el-button",{attrs:{type:"text",loading:t.draftLoading},on:{click:t.storageDraft}},[t._v("存草稿")])],1),t._v(" "),a("markdown-editor",{attrs:{value:t.answer},on:{change:function(e){return t.answer=e}}}),t._v(" "),a("br"),t._v(" "),a("upload-files",{model:{value:t.fileList,callback:function(e){t.fileList=e},expression:"fileList"}}),t._v(" "),a("br"),t._v(" "),a("div",{staticClass:"submit-btn"},[a("el-button",{on:{click:t.resetAnswer}},[t._v("清空")]),t._v(" "),t.editing?a("el-button",{attrs:{type:"primary",loading:t.loading},on:{click:t.updateAnswer}},[t._v("提交")]):a("el-button",{attrs:{type:"primary",loading:t.loading},on:{click:t.submitAnswer}},[t._v("提交")])],1)],1)},staticRenderFns:[]};var le=a("VU/8")(ne,oe,!1,function(t){a("x4Kb")},"data-v-7aa7824e",null).exports,ce={name:"AddHomeworkDialog",props:{classId:{type:String,default:""},createDate:{type:String,default:""},isTA:{type:Boolean,default:!1}},components:{MarkdownEditor:E,UploadFiles:ft,FileList:yt,FullscreenDialog:V},data:function(){return{answer:"",staticAnswer:"",fileList:[],staticFileList:[],editable:!1,visible:!1,loading:!1}},methods:{show:function(t){this.answer=t.answer,this.staticAnswer=t.answer,this.fileList=t.files.map(function(t){return{name:t.name,filename:t.filename}}),this.staticFileList=t.files.map(function(t){return{name:t.name,filename:t.filename}}),this.editable=!1,this.visible=!0},submitHwAnswer:function(){var t,e,a,s=this,i=this.fileList.filter(function(t){return y.isFile(t)}),r=this.fileList.filter(function(t){return y.isPureObject(t)}),n=new bt({files:i,existFiles:Ht()(r),answer:this.answer});this.loading=!0,(t=this.classId,e=this.createDate,a=n,new h.a(function(s,i){F.post("/api/teacher/uploadHwAnswer/"+t+"/"+e,a).then(function(t){0===t.stats?i(t.data.error):s()}).catch(function(t){i(t)})})).then(function(){s.visible=!1,s.loading=!1,s.$emit("fetchData"),s.$message.success("上传成功")}).catch(function(t){s.loading=!1,s.$message.error(t)})},deleteAnswer:function(){var t=this;this.$confirm("确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var e,a;t.loading=!0,(e=t.classId,a=t.createDate,new h.a(function(t,s){F.put("/api/teacher/deleteHwAnswer/"+e+"/"+a).then(function(e){0===e.stats?s(e.data.error):t()}).catch(function(t){s(t)})})).then(function(){t.visible=!1,t.loading=!1,t.$emit("fetchData"),t.$message.success("删除成功")}).catch(function(e){t.loading=!1,t.$message.error(e)})}).catch(function(){})},cancelEdit:function(){this.editable=!1},closeDialog:function(){this.visible=!1}}},ue={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("fullscreen-dialog",{attrs:{title:"答案",visible:t.visible},on:{close:t.closeDialog}},["student"!==t.$store.state.user.role||t.isTA?t._e():a("div",[t.staticAnswer||t.staticFileList.length?a("div",[t.staticAnswer?a("markdown-editor",{attrs:{value:t.staticAnswer,edit:!1}}):t._e(),t._v(" "),a("file-list",{attrs:{files:t.staticFileList}})],1):a("p",[t._v("暂无答案")])]),t._v(" "),"teacher"===t.$store.state.user.role||t.isTA?a("div",[t.editable||!t.staticAnswer&&!t.staticFileList.length?a("div",[a("div",[t.staticAnswer||t.staticFileList.length?a("el-button",{on:{click:t.cancelEdit}},[t._v("取消编辑")]):t._e(),t._v(" "),a("el-button",{attrs:{loading:t.loading},on:{click:t.submitHwAnswer}},[t._v("\n          "+t._s(t.loading?"提交中...":"提交")+"\n        ")])],1),t._v(" "),a("br"),t._v(" "),a("markdown-editor",{attrs:{value:t.answer},on:{change:function(e){return t.answer=e}}}),t._v(" "),a("br"),t._v(" "),a("div",[a("upload-files",{model:{value:t.fileList,callback:function(e){t.fileList=e},expression:"fileList"}})],1)],1):a("div",[a("div",[a("el-button",{on:{click:function(e){t.editable=!0}}},[t._v("编辑")]),t._v(" "),a("el-button",{attrs:{loading:t.loading},on:{click:t.deleteAnswer}},[t._v("\n          "+t._s(t.loading?"删除中...":"删除")+"\n        ")])],1),t._v(" "),a("br"),t._v(" "),a("markdown-editor",{attrs:{value:t.staticAnswer,edit:!1}}),t._v(" "),a("file-list",{attrs:{files:t.staticFileList}})],1)]):t._e()])},staticRenderFns:[]};var de=a("VU/8")(ce,ue,!1,function(t){a("SIU/")},"data-v-e8e24226",null).exports,me={name:"EditHomeworkDialog",components:{MarkdownEditor:E,UploadFiles:ft,FullscreenDialog:V},props:{classId:{type:String,default:""},createDate:{type:String,default:""}},data:function(){var t=this,e=this;return{visible:!1,loading:!1,fileList:[],ruleForm:{title:"",description:"",beginDate:"",endDate:""},rules:{title:[{required:!0,validator:function(t,e,a){""===e?a(new Error("必填")):a()},trigger:"blur"}],beginDate:[{validator:function(e,a,s){t.ruleForm.endDate&&t.ruleForm.beginDate&&t.ruleForm.endDate.getTime()<t.ruleForm.beginDate.getTime()?s(new Error("开始时间不能晚于截止时间")):s()},trigger:"blur"}],endDate:[{validator:function(e,a,s){t.ruleForm.beginDate&&t.ruleForm.endDate&&t.ruleForm.beginDate.getTime()>t.ruleForm.endDate.getTime()?s(new Error("截止时间不能早于开始时间")):s()},trigger:"blur"}]},pickerOptions1:{shortcuts:[{text:"明天",onClick:function(t){var e=new Date,a=new Date((new Date).toLocaleDateString()).getTime();e.setTime(a+864e5),t.$emit("pick",e)}},{text:"后天",onClick:function(t){var e=new Date,a=new Date((new Date).toLocaleDateString()).getTime();e.setTime(a+1728e5),t.$emit("pick",e)}},{text:"三天后",onClick:function(t){var e=new Date,a=new Date((new Date).toLocaleDateString()).getTime();e.setTime(a+2592e5),t.$emit("pick",e)}},{text:"一周后",onClick:function(t){var e=new Date,a=new Date((new Date).toLocaleDateString()).getTime();e.setTime(a+6048e5),t.$emit("pick",e)}}],disabledDate:function(t){return e.ruleForm.endDate?t.getTime()<new Date((new Date).toLocaleDateString()).getTime()||t.getTime()>new Date(e.ruleForm.endDate.toLocaleDateString()).getTime():t.getTime()<new Date((new Date).toLocaleDateString()).getTime()}},pickerOptions2:{shortcuts:[{text:"三天后",onClick:function(t){var e=new Date,a=new Date((new Date).toLocaleDateString()).getTime()-1;e.setTime(a+3456e5),t.$emit("pick",e)}},{text:"五天后",onClick:function(t){var e=new Date,a=new Date((new Date).toLocaleDateString()).getTime()-1;e.setTime(a+5184e5),t.$emit("pick",e)}},{text:"一周后",onClick:function(t){var e=new Date,a=new Date((new Date).toLocaleDateString()).getTime()-1;e.setTime(a+5184e5),t.$emit("pick",e)}},{text:"两周后",onClick:function(t){var e=new Date,a=new Date((new Date).toLocaleDateString()).getTime()-1;e.setTime(a+1296e6),t.$emit("pick",e)}}],disabledDate:function(t){return e.ruleForm.beginDate?t.getTime()<new Date(e.ruleForm.beginDate.toLocaleDateString()).getTime():t.getTime()<new Date((new Date).toLocaleDateString()).getTime()}}}},methods:{show:function(t){this.fileList=t.files,this.ruleForm.title=t.title,this.ruleForm.description=t.description,this.ruleForm.beginDate=t.beginDate&&new Date(+t.beginDate),this.ruleForm.endDate=t.endDate&&new Date(+t.endDate),this.visible=!0},submitForm:function(t){var e=this;this.$refs[t].validate(function(t){if(t){var a=e.fileList.filter(function(t){return y.isFile(t)}),s=e.fileList.filter(function(t){return y.isPureObject(t)}),i=new bt({files:a,existFiles:Ht()(s),title:e.ruleForm.title,description:e.ruleForm.description,beginDate:e.ruleForm.beginDate?e.ruleForm.beginDate.getTime():"",endDate:e.ruleForm.endDate?e.ruleForm.endDate.getTime():""});e.loading=!0,(r=e.classId,n=e.createDate,o=i,new h.a(function(t,e){F.put("/api/teacher/editHw/"+r+"/"+n,o).then(function(a){0===a.stats?e(a.data.error):t()}).catch(function(t){e(t)})})).then(function(){e.visible=!1,e.loading=!1,e.$emit("fetchData")}).catch(function(t){e.loading=!1,e.$message.error(t)})}var r,n,o})},closeDialog:function(){this.visible=!1,this.$refs.ruleForm.clearValidate()}}},fe={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("fullscreen-dialog",{attrs:{title:"修改作业信息",visible:t.visible},on:{close:t.closeDialog}},[a("el-form",{ref:"ruleForm",attrs:{model:t.ruleForm,"status-icon":"",rules:t.rules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"作业标题",prop:"title"}},[a("el-row",[a("el-col",{attrs:{span:22}},[a("el-input",{attrs:{placeholder:"50字以内",clearable:!0,maxlength:50},model:{value:t.ruleForm.title,callback:function(e){t.$set(t.ruleForm,"title",e)},expression:"ruleForm.title"}})],1),t._v(" "),a("el-col",{attrs:{span:2}},[a("span",{staticStyle:{"padding-left":"5px"}},[t._v(t._s(t.ruleForm.title.length)+"/50")])])],1)],1),t._v(" "),a("el-form-item",{attrs:{label:"作业详情",prop:"description"}},[a("markdown-editor",{attrs:{value:t.ruleForm.description},on:{change:function(e){return t.ruleForm.description=e}}})],1),t._v(" "),a("el-form-item",{attrs:{label:"开始时间",prop:"beginDate"}},[a("el-date-picker",{attrs:{type:"datetime",placeholder:"选择日期时间","picker-options":t.pickerOptions1},model:{value:t.ruleForm.beginDate,callback:function(e){t.$set(t.ruleForm,"beginDate",e)},expression:"ruleForm.beginDate"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"结束时间",prop:"endDate"}},[a("el-date-picker",{attrs:{type:"datetime",placeholder:"选择日期时间","default-time":"23:59:59","picker-options":t.pickerOptions2},model:{value:t.ruleForm.endDate,callback:function(e){t.$set(t.ruleForm,"endDate",e)},expression:"ruleForm.endDate"}})],1),t._v(" "),a("div",{staticClass:"form-item-upload"},[a("upload-files",{model:{value:t.fileList,callback:function(e){t.fileList=e},expression:"fileList"}})],1),t._v(" "),a("el-form-item",[a("el-button",{on:{click:t.closeDialog}},[t._v("取消")]),t._v(" "),a("el-button",{staticClass:"submit-btn",attrs:{type:"primary"},on:{click:function(e){t.submitForm("ruleForm")}}},[t._v("提交")])],1)],1)],1)},staticRenderFns:[]};var he={name:"HomeworkPage",created:function(){this.fetchData()},components:{SubmissionsTable:re,SubmitHomework:le,MarkdownEditor:E,FileList:yt,HwAnswerDialog:de,EditHomeworkDialog:a("VU/8")(me,fe,!1,function(t){a("7jdX")},"data-v-7d0796c0",null).exports,PageLoading:b,Breadcrumb:ut},computed:{expired:function(){return this.homework.beginDate&&this.homework.beginDate>Date.now()?0:this.homework.endDate&&this.homework.endDate<Date.now()?1:2},isTA:function(){for(var t=this.$store.state.user.email,e=0;e<this.homework.tas.length;e+=1)if(this.homework.tas[e].email===t)return!0;return!1}},data:function(){return{homework:{createDate:"",beginDate:"",endDate:"",title:"",description:"",submissions:[],files:[],hwAnswer:{answer:"",files:[]},tas:[],draft:null},editingSub:null,cancelLoading:!1,loading:!1,error:!1}},methods:{fetchData:function(){var t=this;this.loading=!0,this.error=!1,Yt(this.$route.params.classId,this.$route.params.createDate).then(function(e){t.loading=!1,t.homework=e,t.editingSub=null}).catch(function(e){t.loading=!1,t.error=!0,t.$message.error(e)})},fetchDataByDraft:function(){var t=this;Yt(this.$route.params.classId,this.$route.params.createDate).then(function(e){t.homework=e}).catch(function(e){t.$message.error(e)})},deleteHwSub:function(){var t=this;this.$confirm("确认撤销作业提交？撤销操作不可逆！","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var e,a,s;t.cancelLoading=!0,(e=t.$route.params.classId,a=t.$route.params.createDate,new h.a(function(t,i){F.put("/api/student/deleteHwSub/"+e+"/"+a,s).then(function(e){0===e.stats?i(e.data.error):t()}).catch(function(t){i(t)})})).then(function(){t.cancelLoading=!1,t.fetchData()}).catch(function(e){t.cancelLoading=!1,t.$message.error(e)})}).catch(function(){})},formateDate:function(t){return t?y.formateDate(+t):"--"},showHwAnswerDialog:function(){this.$refs.hwAnswerDialogRef.show(this.homework.hwAnswer)},showEditHomeworkDialog:function(){this.$refs.editHomeworkDialogRef.show(this.homework)}},filters:{hwStatus:function(t){return 0===t?"未开始":1===t?"已截止":"进行中"},answerStatus:function(t,e,a,s){return e||a?"查看答案":"student"!==t||s?"上传答案":"暂无答案"}}},pe={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("vue-headful",{attrs:{title:t.$route.meta.title}}),t._v(" "),t.loading||t.error?a("page-loading",{attrs:{loading:t.loading,error:t.error}}):t._e(),t._v(" "),!t.loading&&!t.error&&t.$store.state.user.email&&t.homework.createDate?a("div",[a("div",{staticClass:"hw-box"},[a("div",{staticClass:"custom-card"},[a("p",[a("breadcrumb",{staticClass:"breadcrumb",attrs:{paths:[{name:"主页",to:"/"},{name:"班级",to:"/class/"+t.$route.params.classId},{name:"作业"}]}}),t._v(" "),a("span",{staticClass:"hw-title"},[t._v(t._s(t.homework.title))]),t._v(" "),a("span",{class:"hw-stauts-"+t.expired},[t._v(t._s(t._f("hwStatus")(t.expired)))]),t._v(" "),"teacher"===t.$store.state.user.role?a("span",[a("el-button",{attrs:{type:"text"},on:{click:function(e){t.showEditHomeworkDialog()}}},[a("span",[t._v("编辑作业信息")]),t._v(" "),a("i",{staticClass:"el-icon-edit"})])],1):t._e(),t._v(" "),a("span",{staticClass:"hw-answer tmcu-btn",on:{click:function(e){t.showHwAnswerDialog()}}},[t._v("\n            "+t._s(t._f("answerStatus")(t.$store.state.user.role,t.homework.hwAnswer.answer,t.homework.hwAnswer.files.length,t.isTA))+"\n          ")])],1),t._v(" "),a("p",[a("span",{staticClass:"hw-info tmcu-text"},[t._v("创建时间: "+t._s(t.formateDate(t.homework.createDate)))]),t._v(" "),a("span",{staticClass:"hw-info tmcu-text"},[t._v("开始时间: "+t._s(t.formateDate(t.homework.beginDate)))]),t._v(" "),a("span",{staticClass:"hw-info tmcu-text"},[t._v("截止时间: "+t._s(t.formateDate(t.homework.endDate)))])])]),t._v(" "),a("markdown-editor",{attrs:{value:t.homework.description,edit:!1}}),t._v(" "),a("file-list",{attrs:{files:t.homework.files}})],1),t._v(" "),"teacher"===t.$store.state.user.role||t.isTA?a("div",[a("p",{staticClass:"tmcu-text"},[t._v("共 "+t._s(t.homework.submissions.length)+" 人提交")]),t._v(" "),a("submissions-table",{attrs:{submissions:t.homework.submissions,classId:t.$route.params.classId,createDate:t.homework.createDate},on:{fetchData:t.fetchData}})],1):t._e(),t._v(" "),"student"!==t.$store.state.user.role||t.isTA?t._e():a("div",[t.homework.submissions.length?a("div",[a("p",{staticClass:"tmcu-text"},[a("el-tag",{attrs:{size:"small"}},[t._v("已提交")]),t._v(" "),t.homework.submissions[0].checked||2!==t.expired?t._e():a("span",[a("el-button",{attrs:{type:"text"},on:{click:function(e){t.editingSub=t.homework.submissions[0]}}},[t._v("编辑")])],1),t._v(" "),t.homework.submissions[0].checked||2!==t.expired?t._e():a("span",[a("el-button",{attrs:{type:"text",loading:t.cancelLoading},on:{click:t.deleteHwSub}},[t._v("撤销")])],1)],1),t._v(" "),a("p",{staticClass:"tmcu-text"},[a("span",[t._v("提交时间: "+t._s(t.formateDate(t.homework.submissions[0].date)))])]),t._v(" "),a("div",{staticClass:"tmcu-text"},[t.homework.submissions[0].checked?a("p",[a("el-tag",{attrs:{size:"small"}},[t._v("已审阅")]),t._v(" "),a("span",[t._v("反馈结果: "+t._s(t.homework.submissions[0].feedback||"无"))])],1):a("p",[a("el-tag",{attrs:{type:"warning",size:"small"}},[t._v("未审阅")])],1)]),t._v(" "),t.editingSub?a("div",[a("p",[a("span",{staticClass:"tmcu-text"},[t._v("正在修改已提交作业")]),t._v(" "),a("el-button",{attrs:{type:"text"},on:{click:function(e){t.editingSub=null}}},[t._v("放弃修改")])],1),t._v(" "),a("br"),t._v(" "),a("submit-homework",{attrs:{classId:t.$route.params.classId,createDate:t.homework.createDate,text:t.editingSub.answer,files:t.editingSub.files,editing:!0,draft:t.homework.draft},on:{fetchData:t.fetchData,fetchDataByDraft:t.fetchDataByDraft}})],1):a("div",[a("p",{staticClass:"tmcu-text"},[t._v("提交详情:")]),t._v(" "),a("br"),t._v(" "),a("markdown-editor",{attrs:{value:t.homework.submissions[0].answer,edit:!1}}),t._v(" "),a("file-list",{attrs:{files:t.homework.submissions[0].files}})],1)]):a("div",[a("p",[a("el-tag",{attrs:{type:"danger",size:"small"}},[t._v("未提交")])],1),t._v(" "),a("br"),t._v(" "),2===t.expired?a("submit-homework",{attrs:{classId:t.$route.params.classId,createDate:t.homework.createDate,text:"",files:[],editing:!1,draft:t.homework.draft},on:{fetchData:t.fetchData,fetchDataByDraft:t.fetchDataByDraft}}):t._e()],1)]),t._v(" "),a("hw-answer-dialog",{ref:"hwAnswerDialogRef",attrs:{classId:t.$route.params.classId,createDate:t.homework.createDate,isTA:t.isTA},on:{fetchData:t.fetchData}}),t._v(" "),a("edit-homework-dialog",{ref:"editHomeworkDialogRef",attrs:{classId:t.$route.params.classId,createDate:t.homework.createDate},on:{fetchData:t.fetchData}})],1):t._e()],1)},staticRenderFns:[]};var ve=a("VU/8")(he,pe,!1,function(t){a("CQKV")},"data-v-6bc45944",null).exports;s.default.use(p.a);var ge=new p.a({mode:"history",routes:[{path:"/",name:"Home",component:q,meta:{title:"高校教学管理系统",auth:2}},{path:"/regist",name:"RegistPage",component:Z,meta:{title:"高校教学管理系统 | 注册",auth:1}},{path:"/login",name:"LoginPage",component:X,meta:{title:"高校教学管理系统 | 登录",auth:1}},{path:"/forgot",name:"ForgotPassword",component:et,meta:{title:"高校教学管理系统 | 忘记密码",auth:1}},{path:"/reset/:resetId([a-f0-9]{24})",name:"ResetPassword",component:it,meta:{title:"高校教学管理系统 | 重置密码",auth:1}},{path:"/activate/:activateId([a-f0-9]{24})",name:"ActivateEmail",component:ot,meta:{title:"高校教学管理系统 | 激活邮箱",auth:1}},{path:"/class/:classId",name:"ClassPage",component:Jt,meta:{title:"高校教学管理系统 | 班级",auth:2}},{path:"/hw/:classId/:createDate([0-9]{13})",name:"HomeworkPage",component:ve,meta:{title:"高校教学管理系统 | 作业",auth:2}},{path:"/*",component:Xt,meta:{title:"高校教学管理系统 | 页面不存在",auth:0}}],scrollBehavior:function(){return new h.a(function(t){setTimeout(function(){t({x:0,y:0})},0)})}}),be=a("NYxO");s.default.use(be.a);var we={user:{name:"",stuId:"",email:"",role:""}},_e={refreshHeader:function(){return new h.a(function(t){F.get("/api/general/profile").then(function(e){1===e.stats?we.user=e.data.profile:we.user={name:"",stuId:"",email:"",role:""},t()}).catch(function(){we.user={name:"",stuId:"",email:"",role:""},t()})})}},De=new be.a.Store({state:we,actions:_e});ge.beforeEach(function(t,e,a){1===t.meta.auth&&De.state.user.email?a("/"):2!==t.meta.auth||De.state.user.email?a():a("/login")});var Fe={name:"EditProfileDialog",data:function(){return{visible:!1,loading:!1,ruleForm:{name:"",stuId:""},rules:{name:[{required:!0,validator:function(t,e,a){""===e?a(new Error("必填")):a()},trigger:"blur"}],stuId:[{required:!0,validator:function(t,e,a){""===e?a(new Error("必填")):a()},trigger:"blur"}]}}},methods:{show:function(t,e){this.ruleForm.name=t,this.ruleForm.stuId=e,this.visible=!0},submitForm:function(t){var e=this;this.$refs[t].validate(function(t){var a;t&&(e.loading=!0,(a={name:e.ruleForm.name,stuId:e.ruleForm.stuId},new h.a(function(t,e){F.put("/api/student/editUserMsg",a).then(function(a){0===a.stats?e(a.data.error):t()}).catch(function(t){e(t)})})).then(function(){e.visible=!1,e.loading=!1,e.$store.dispatch("refreshHeader")}).catch(function(t){e.loading=!1,e.$message.error(t)}))})},closeDialog:function(){this.visible=!1,this.$refs.ruleForm.clearValidate()}}},ke={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{title:"修改个人信息",width:"50%",modal:!1,visible:t.visible},on:{close:t.closeDialog}},[a("el-form",{ref:"ruleForm",attrs:{model:t.ruleForm,"status-icon":"",rules:t.rules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"姓名",prop:"name"}},[a("el-input",{attrs:{"auto-complete":"on"},model:{value:t.ruleForm.name,callback:function(e){t.$set(t.ruleForm,"name",e)},expression:"ruleForm.name"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"学号",prop:"stuId"}},[a("el-input",{attrs:{"auto-complete":"on"},model:{value:t.ruleForm.stuId,callback:function(e){t.$set(t.ruleForm,"stuId",e)},expression:"ruleForm.stuId"}})],1),t._v(" "),a("el-form-item",[a("el-button",{on:{click:t.closeDialog}},[t._v("取消")]),t._v(" "),a("el-button",{staticClass:"submit-btn",attrs:{type:"primary",loading:t.loading},on:{click:function(e){t.submitForm("ruleForm")}}},[t._v("提交")])],1)],1)],1)},staticRenderFns:[]};var $e={name:"TopHeader",components:{EditProfileDialog:a("VU/8")(Fe,ke,!1,function(t){a("Jcsu")},"data-v-117d296c",null).exports},methods:{login:function(){this.$router.push("/login")},regist:function(){this.$router.push("/regist")},logout:function(){var t=this;new h.a(function(t,e){F.post("/api/general/logout").then(function(a){0===a.stats?e(a.data.error):t()}).catch(function(t){e(t)})}).then(function(){t.$store.dispatch("refreshHeader").then(function(){t.$router.push("/login")})}).catch(function(e){t.$message.error(e)})},handleCommand:function(t){"editProfile"===t?this.$refs.editProfileDialogRef.show(this.$store.state.user.name,this.$store.state.user.stuId):"logout"===t&&this.logout()}},filters:{roleFilter:function(t,e){return"teacher"===t?"老师":"("+e+") 同学"}}},Ce={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-row",[a("el-col",{attrs:{span:12}},[a("router-link",{staticClass:"header-link",attrs:{to:"/"}},[a("img",{staticClass:"logo-img",attrs:{src:"/static/logo.png",alt:"高校教学管理系统"}})])],1),t._v(" "),a("el-col",{attrs:{span:12}},[t.$store.state.user.email?a("div",{staticClass:"profile"},[a("span",{staticClass:"profile-msg"},[t._v("\n          "+t._s(t.$store.state.user.name)+"\n          "+t._s(t._f("roleFilter")(t.$store.state.user.role,t.$store.state.user.stuId))+"\n        ")]),t._v(" "),a("span",{staticClass:"user-img"}),t._v(" "),a("el-dropdown",{attrs:{placement:"bottom"},on:{command:t.handleCommand}},[a("span",{staticClass:"el-dropdown-link"},[a("i",{staticClass:"el-icon-caret-bottom el-icon--right"})]),t._v(" "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},["student"===t.$store.state.user.role?a("el-dropdown-item",{attrs:{command:"editProfile"}},[t._v("修改姓名学号")]):t._e(),t._v(" "),a("el-dropdown-item",{attrs:{command:"logout"}},[t._v("退出")])],1)],1)],1):a("div",{staticClass:"profile"},[a("el-button",{attrs:{type:"primary"},on:{click:t.login}},[t._v("登录")]),t._v(" "),a("el-button",{on:{click:t.regist}},[t._v("注册")])],1)])],1),t._v(" "),a("edit-profile-dialog",{ref:"editProfileDialogRef"})],1)},staticRenderFns:[]};var xe=a("VU/8")($e,Ce,!1,function(t){a("TyxH")},"data-v-97758126",null).exports,ye=(a("Br6R"),{name:"App",components:{TopHeader:xe},mounted:function(){window.onscroll=this.scroll},data:function(){return{enterActiveClass:"animated slideInRight",scrollTop:0,scrollStepPx:0,scrollDirection:"top",headerClass:{"top-header":!0}}},watch:{$route:function(t,e){this.$router.prePages||(this.$router.prePages=[]),t.name===this.$router.prePages[this.$router.prePages.length-1]?(this.enterActiveClass="animated slideInLeft",this.$router.prePages.pop()):(this.enterActiveClass="animated slideInRight",this.$router.prePages.push(e.name))}},methods:{scroll:function(){var t=document.body.scrollTop+document.documentElement.scrollTop;t>this.scrollTop?this.scrollDirection="down":this.scrollDirection="top",this.scrollTop=t,this.headerClass={"top-header":!0,"top-header-gone":this.scrollTop>100&&"down"===this.scrollDirection,"top-header-back":"top"===this.scrollDirection}},backTop:function(){this.scrollStepPx=this.scrollTop/30,window.requestAnimationFrame(this.scrollStep)},scrollStep:function(){this.scrollTop-=this.scrollStepPx,document.body.scrollTop=this.scrollTop,document.documentElement.scrollTop=this.scrollTop,this.scrollTop>0&&window.requestAnimationFrame(this.scrollStep)}}}),Se={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("el-container",[e("el-header",{class:this.headerClass,attrs:{height:"60px"}},[e("top-header")],1),this._v(" "),e("el-main",{staticClass:"main-container"},[e("transition",{attrs:{"enter-active-class":this.enterActiveClass}},[e("router-view")],1)],1)],1),this._v(" "),this.scrollTop>400?e("div",{staticClass:"scroll-top tmcu-btn",on:{click:this.backTop}},[e("i",{staticClass:"el-icon-caret-top"})]):this._e()],1)},staticRenderFns:[]};var Ie=a("VU/8")(ye,Se,!1,function(t){a("4yFy")},"data-v-81e370ae",null).exports;s.default.config.productionTip=!1,s.default.use(r.a),s.default.use(o.a),s.default.use(u.a),s.default.component("vue-headful",m.a),s.default.component("vue-draggable",c.a),De.dispatch("refreshHeader").then(function(){new s.default({el:"#app",router:ge,store:De,render:function(t){return t(Ie)}})})},Q0sH:function(t,e){},QJFS:function(t,e){},"SIU/":function(t,e){},SdsR:function(t,e){},TxOr:function(t,e){},TyxH:function(t,e){},Vm1m:function(t,e){},WKXR:function(t,e){},ZWOs:function(t,e){},a3j2:function(t,e){},a7Sb:function(t,e){},cFeA:function(t,e){},dBIN:function(t,e){},"gI/P":function(t,e){},h2hJ:function(t,e){},jxe7:function(t,e){},lESa:function(t,e){},lnvI:function(t,e){},mtQr:function(t,e){},pu2X:function(t,e){},pw1w:function(t,e){},r8ZB:function(t,e){},tvR6:function(t,e){},x4Kb:function(t,e){},z6Ih:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.5d5b80943b0954fab1de.js.map